<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot) | TinyX</title>
<meta name="keywords" content="BeagleBone, U-Boot">
<meta name="description" content="æ›´æ–°ï¼š2016-04-01
ä»€ä¹ˆæ˜¯ U-Boot ç†Ÿæ‚‰åµŒå…¥å¼å¼€å‘çš„åº”è¯¥éƒ½å¬è¿‡å®ƒï¼ŒU-boot å°±æ˜¯å¯åŠ¨ç³»ç»Ÿå‰çš„ä¸€æ®µå¼•å¯¼ç¨‹åºï¼Œè™½ç„¶æ˜¯å¼•å¯¼ç¨‹åºï¼Œä½†æ˜¯åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚
è¿™ä¸€ç¯‡ä¸»è¦è®²è§£å¦‚ä½•ä»æ— åˆ°æœ‰è¿è¡Œ U-Bootï¼Œå…³äº U-Boot å¼•å¯¼ Linux çš„éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è®²è§£ã€‚
U-Boot ä¹‹å‰çš„ç‰ˆæœ¬ä»¥ç‰ˆæœ¬å·å‘½åå¦‚ï¼š0.1.0, 0.2.0 è¿™å‡ å¹´æ”¹ä¸ºäº†ä»¥æ—¶é—´å’Œæ—¥æœŸå‘½åï¼šU-Boot 2016.03ã€‚
ä½¿ç”¨ git è·å¾— U-Boot çš„æºç ï¼š
git clone git://git.denx.de/u-boot.git ç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯ 2016.02 çš„ç‰ˆæœ¬ã€‚
MLO åŠå…¶å¯åŠ¨è¿‡ç¨‹ ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬äº†è§£äº† BeagleBone æœ‰ä¸ª SPL è¿‡ç¨‹ï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™è¯»å– MLO æ–‡ä»¶ï¼ŒMLO æ–‡ä»¶å…¶å®æ˜¯ä¸ªç²¾ç®€ç‰ˆçš„ U-Bootï¼Œä¹Ÿæ˜¯ç”± U-Boot ç”Ÿæˆï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é™ï¼Œåªåˆå§‹åŒ–äº†éƒ¨åˆ†èµ„æºå¦‚ DDRï¼Œç„¶åå¯åŠ¨ U-Bootã€‚
MLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„ åˆ†æ MLO çš„ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰éœ€è¦çŸ¥é“ç¼–è¯‘åŸç†å’Œ Makefile ç­‰ç›¸å…³çŸ¥è¯†ã€‚ æˆ‘ä»¬å…ˆæ‰¾æ‰¾ Makefile çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆã€‚å»ºè®®ä½¿ç”¨ Sublime ç¼–è¾‘å™¨ã€‚ç”¨å…¨å±€æŸ¥æ‰¾åŠŸèƒ½æŸ¥æ‰¾ MLO å…³é”®å­—ã€‚
æ‰¾åˆ° u-boot/scripts/Makefile.spl æ–‡ä»¶ 117è¡Œï¼š
MLO MLO.byteswap: $(obj)/u-boot-spl.bin FORCE 	$(call if_changed,mkimage) å¯ä»¥çœ‹åˆ° MLO æ–‡ä»¶æ˜¯ç”± u-boot-spl.">
<meta name="author" content="X">
<link rel="canonical" href="https://jesseguox.github.io/tinyx/post/BBB-Uboot/">
<link crossorigin="anonymous" href="/tinyx/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css" integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/tinyx/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js" integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot)" />
<meta property="og:description" content="æ›´æ–°ï¼š2016-04-01
ä»€ä¹ˆæ˜¯ U-Boot ç†Ÿæ‚‰åµŒå…¥å¼å¼€å‘çš„åº”è¯¥éƒ½å¬è¿‡å®ƒï¼ŒU-boot å°±æ˜¯å¯åŠ¨ç³»ç»Ÿå‰çš„ä¸€æ®µå¼•å¯¼ç¨‹åºï¼Œè™½ç„¶æ˜¯å¼•å¯¼ç¨‹åºï¼Œä½†æ˜¯åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚
è¿™ä¸€ç¯‡ä¸»è¦è®²è§£å¦‚ä½•ä»æ— åˆ°æœ‰è¿è¡Œ U-Bootï¼Œå…³äº U-Boot å¼•å¯¼ Linux çš„éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è®²è§£ã€‚
U-Boot ä¹‹å‰çš„ç‰ˆæœ¬ä»¥ç‰ˆæœ¬å·å‘½åå¦‚ï¼š0.1.0, 0.2.0 è¿™å‡ å¹´æ”¹ä¸ºäº†ä»¥æ—¶é—´å’Œæ—¥æœŸå‘½åï¼šU-Boot 2016.03ã€‚
ä½¿ç”¨ git è·å¾— U-Boot çš„æºç ï¼š
git clone git://git.denx.de/u-boot.git ç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯ 2016.02 çš„ç‰ˆæœ¬ã€‚
MLO åŠå…¶å¯åŠ¨è¿‡ç¨‹ ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬äº†è§£äº† BeagleBone æœ‰ä¸ª SPL è¿‡ç¨‹ï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™è¯»å– MLO æ–‡ä»¶ï¼ŒMLO æ–‡ä»¶å…¶å®æ˜¯ä¸ªç²¾ç®€ç‰ˆçš„ U-Bootï¼Œä¹Ÿæ˜¯ç”± U-Boot ç”Ÿæˆï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é™ï¼Œåªåˆå§‹åŒ–äº†éƒ¨åˆ†èµ„æºå¦‚ DDRï¼Œç„¶åå¯åŠ¨ U-Bootã€‚
MLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„ åˆ†æ MLO çš„ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰éœ€è¦çŸ¥é“ç¼–è¯‘åŸç†å’Œ Makefile ç­‰ç›¸å…³çŸ¥è¯†ã€‚ æˆ‘ä»¬å…ˆæ‰¾æ‰¾ Makefile çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆã€‚å»ºè®®ä½¿ç”¨ Sublime ç¼–è¾‘å™¨ã€‚ç”¨å…¨å±€æŸ¥æ‰¾åŠŸèƒ½æŸ¥æ‰¾ MLO å…³é”®å­—ã€‚
æ‰¾åˆ° u-boot/scripts/Makefile.spl æ–‡ä»¶ 117è¡Œï¼š
MLO MLO.byteswap: $(obj)/u-boot-spl.bin FORCE 	$(call if_changed,mkimage) å¯ä»¥çœ‹åˆ° MLO æ–‡ä»¶æ˜¯ç”± u-boot-spl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jesseguox.github.io/tinyx/post/BBB-Uboot/" /><meta property="og:image" content="https://jesseguox.github.io/tinyx/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2016-03-22T20:57:50&#43;00:00" />
<meta property="article:modified_time" content="2016-03-22T20:57:50&#43;00:00" /><meta property="og:site_name" content="ExampleSite" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jesseguox.github.io/tinyx/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/>

<meta name="twitter:title" content="BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot)"/>
<meta name="twitter:description" content="æ›´æ–°ï¼š2016-04-01
ä»€ä¹ˆæ˜¯ U-Boot ç†Ÿæ‚‰åµŒå…¥å¼å¼€å‘çš„åº”è¯¥éƒ½å¬è¿‡å®ƒï¼ŒU-boot å°±æ˜¯å¯åŠ¨ç³»ç»Ÿå‰çš„ä¸€æ®µå¼•å¯¼ç¨‹åºï¼Œè™½ç„¶æ˜¯å¼•å¯¼ç¨‹åºï¼Œä½†æ˜¯åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚
è¿™ä¸€ç¯‡ä¸»è¦è®²è§£å¦‚ä½•ä»æ— åˆ°æœ‰è¿è¡Œ U-Bootï¼Œå…³äº U-Boot å¼•å¯¼ Linux çš„éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è®²è§£ã€‚
U-Boot ä¹‹å‰çš„ç‰ˆæœ¬ä»¥ç‰ˆæœ¬å·å‘½åå¦‚ï¼š0.1.0, 0.2.0 è¿™å‡ å¹´æ”¹ä¸ºäº†ä»¥æ—¶é—´å’Œæ—¥æœŸå‘½åï¼šU-Boot 2016.03ã€‚
ä½¿ç”¨ git è·å¾— U-Boot çš„æºç ï¼š
git clone git://git.denx.de/u-boot.git ç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯ 2016.02 çš„ç‰ˆæœ¬ã€‚
MLO åŠå…¶å¯åŠ¨è¿‡ç¨‹ ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬äº†è§£äº† BeagleBone æœ‰ä¸ª SPL è¿‡ç¨‹ï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™è¯»å– MLO æ–‡ä»¶ï¼ŒMLO æ–‡ä»¶å…¶å®æ˜¯ä¸ªç²¾ç®€ç‰ˆçš„ U-Bootï¼Œä¹Ÿæ˜¯ç”± U-Boot ç”Ÿæˆï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é™ï¼Œåªåˆå§‹åŒ–äº†éƒ¨åˆ†èµ„æºå¦‚ DDRï¼Œç„¶åå¯åŠ¨ U-Bootã€‚
MLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„ åˆ†æ MLO çš„ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰éœ€è¦çŸ¥é“ç¼–è¯‘åŸç†å’Œ Makefile ç­‰ç›¸å…³çŸ¥è¯†ã€‚ æˆ‘ä»¬å…ˆæ‰¾æ‰¾ Makefile çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆã€‚å»ºè®®ä½¿ç”¨ Sublime ç¼–è¾‘å™¨ã€‚ç”¨å…¨å±€æŸ¥æ‰¾åŠŸèƒ½æŸ¥æ‰¾ MLO å…³é”®å­—ã€‚
æ‰¾åˆ° u-boot/scripts/Makefile.spl æ–‡ä»¶ 117è¡Œï¼š
MLO MLO.byteswap: $(obj)/u-boot-spl.bin FORCE 	$(call if_changed,mkimage) å¯ä»¥çœ‹åˆ° MLO æ–‡ä»¶æ˜¯ç”± u-boot-spl."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://jesseguox.github.io/tinyx/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot)",
      "item": "https://jesseguox.github.io/tinyx/post/BBB-Uboot/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot)",
  "name": "BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot)",
  "description": "æ›´æ–°ï¼š2016-04-01\nä»€ä¹ˆæ˜¯ U-Boot ç†Ÿæ‚‰åµŒå…¥å¼å¼€å‘çš„åº”è¯¥éƒ½å¬è¿‡å®ƒï¼ŒU-boot å°±æ˜¯å¯åŠ¨ç³»ç»Ÿå‰çš„ä¸€æ®µå¼•å¯¼ç¨‹åºï¼Œè™½ç„¶æ˜¯å¼•å¯¼ç¨‹åºï¼Œä½†æ˜¯åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚\nè¿™ä¸€ç¯‡ä¸»è¦è®²è§£å¦‚ä½•ä»æ— åˆ°æœ‰è¿è¡Œ U-Bootï¼Œå…³äº U-Boot å¼•å¯¼ Linux çš„éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è®²è§£ã€‚\nU-Boot ä¹‹å‰çš„ç‰ˆæœ¬ä»¥ç‰ˆæœ¬å·å‘½åå¦‚ï¼š0.1.0, 0.2.0 è¿™å‡ å¹´æ”¹ä¸ºäº†ä»¥æ—¶é—´å’Œæ—¥æœŸå‘½åï¼šU-Boot 2016.03ã€‚\nä½¿ç”¨ git è·å¾— U-Boot çš„æºç ï¼š\ngit clone git://git.denx.de/u-boot.git ç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯ 2016.02 çš„ç‰ˆæœ¬ã€‚\nMLO åŠå…¶å¯åŠ¨è¿‡ç¨‹ ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬äº†è§£äº† BeagleBone æœ‰ä¸ª SPL è¿‡ç¨‹ï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™è¯»å– MLO æ–‡ä»¶ï¼ŒMLO æ–‡ä»¶å…¶å®æ˜¯ä¸ªç²¾ç®€ç‰ˆçš„ U-Bootï¼Œä¹Ÿæ˜¯ç”± U-Boot ç”Ÿæˆï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é™ï¼Œåªåˆå§‹åŒ–äº†éƒ¨åˆ†èµ„æºå¦‚ DDRï¼Œç„¶åå¯åŠ¨ U-Bootã€‚\nMLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„ åˆ†æ MLO çš„ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰éœ€è¦çŸ¥é“ç¼–è¯‘åŸç†å’Œ Makefile ç­‰ç›¸å…³çŸ¥è¯†ã€‚ æˆ‘ä»¬å…ˆæ‰¾æ‰¾ Makefile çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆã€‚å»ºè®®ä½¿ç”¨ Sublime ç¼–è¾‘å™¨ã€‚ç”¨å…¨å±€æŸ¥æ‰¾åŠŸèƒ½æŸ¥æ‰¾ MLO å…³é”®å­—ã€‚\næ‰¾åˆ° u-boot/scripts/Makefile.spl æ–‡ä»¶ 117è¡Œï¼š\nMLO MLO.byteswap: $(obj)/u-boot-spl.bin FORCE \t$(call if_changed,mkimage) å¯ä»¥çœ‹åˆ° MLO æ–‡ä»¶æ˜¯ç”± u-boot-spl.",
  "keywords": [
    "BeagleBone", "U-Boot"
  ],
  "articleBody": "æ›´æ–°ï¼š2016-04-01\nä»€ä¹ˆæ˜¯ U-Boot ç†Ÿæ‚‰åµŒå…¥å¼å¼€å‘çš„åº”è¯¥éƒ½å¬è¿‡å®ƒï¼ŒU-boot å°±æ˜¯å¯åŠ¨ç³»ç»Ÿå‰çš„ä¸€æ®µå¼•å¯¼ç¨‹åºï¼Œè™½ç„¶æ˜¯å¼•å¯¼ç¨‹åºï¼Œä½†æ˜¯åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚\nè¿™ä¸€ç¯‡ä¸»è¦è®²è§£å¦‚ä½•ä»æ— åˆ°æœ‰è¿è¡Œ U-Bootï¼Œå…³äº U-Boot å¼•å¯¼ Linux çš„éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è®²è§£ã€‚\nU-Boot ä¹‹å‰çš„ç‰ˆæœ¬ä»¥ç‰ˆæœ¬å·å‘½åå¦‚ï¼š0.1.0, 0.2.0 è¿™å‡ å¹´æ”¹ä¸ºäº†ä»¥æ—¶é—´å’Œæ—¥æœŸå‘½åï¼šU-Boot 2016.03ã€‚\nä½¿ç”¨ git è·å¾— U-Boot çš„æºç ï¼š\ngit clone git://git.denx.de/u-boot.git ç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯ 2016.02 çš„ç‰ˆæœ¬ã€‚\nMLO åŠå…¶å¯åŠ¨è¿‡ç¨‹ ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬äº†è§£äº† BeagleBone æœ‰ä¸ª SPL è¿‡ç¨‹ï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™è¯»å– MLO æ–‡ä»¶ï¼ŒMLO æ–‡ä»¶å…¶å®æ˜¯ä¸ªç²¾ç®€ç‰ˆçš„ U-Bootï¼Œä¹Ÿæ˜¯ç”± U-Boot ç”Ÿæˆï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é™ï¼Œåªåˆå§‹åŒ–äº†éƒ¨åˆ†èµ„æºå¦‚ DDRï¼Œç„¶åå¯åŠ¨ U-Bootã€‚\nMLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„ åˆ†æ MLO çš„ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰éœ€è¦çŸ¥é“ç¼–è¯‘åŸç†å’Œ Makefile ç­‰ç›¸å…³çŸ¥è¯†ã€‚ æˆ‘ä»¬å…ˆæ‰¾æ‰¾ Makefile çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆã€‚å»ºè®®ä½¿ç”¨ Sublime ç¼–è¾‘å™¨ã€‚ç”¨å…¨å±€æŸ¥æ‰¾åŠŸèƒ½æŸ¥æ‰¾ MLO å…³é”®å­—ã€‚\næ‰¾åˆ° u-boot/scripts/Makefile.spl æ–‡ä»¶ 117è¡Œï¼š\nMLO MLO.byteswap: $(obj)/u-boot-spl.bin FORCE \t$(call if_changed,mkimage) å¯ä»¥çœ‹åˆ° MLO æ–‡ä»¶æ˜¯ç”± u-boot-spl.bin æ–‡ä»¶é€šè¿‡ mkimage å‘½ä»¤ç”Ÿæˆçš„ã€‚ å†æŸ¥åˆ° u-boot/Makefile æ–‡ä»¶ 1310 è¡Œï¼š\nspl/u-boot-spl.bin: spl/u-boot-spl \t@: spl/u-boot-spl: tools prepare $(if $(CONFIG_OF_SEPARATE),dts/dt.dtb) \t$(Q)$(MAKE) obj=spl -f $(srctree)/scripts/Makefile.spl all u-boot-spl.bin æ–‡ä»¶æ˜¯è¿˜æ˜¯ç”± u-boot/scripts/Makefile.spl æ–‡ä»¶ç”Ÿæˆã€‚ æ–‡ä»¶ u-boot/scripts/Makefile.spl 168 è¡Œ å®šä¹‰äº† u-boot-spl.bin çš„ç”Ÿæˆï¼š\nifeq ($(CONFIG_SPL_OF_CONTROL),y) $(obj)/$(SPL_BIN)-dtb.bin: $(obj)/$(SPL_BIN)-nodtb.bin $(obj)/$(SPL_BIN)-pad.bin \\ $(obj)/$(SPL_BIN).dtb FORCE $(call if_changed,cat) $(obj)/$(SPL_BIN).bin: $(obj)/$(SPL_BIN)-dtb.bin FORCE $(call if_changed,copy) else $(obj)/$(SPL_BIN).bin: $(obj)/$(SPL_BIN)-nodtb.bin FORCE $(call if_changed,copy) endif å› ä¸º SPL_BIN åœ¨ ç¬¬32è¡Œ å®šä¹‰ä¸º u-boot-spl:\n{% codeblock lang:make u-boot/scripts/Makefile.spl %} ifeq ($(CONFIG_TPL_BUILD),y) SPL_BIN := u-boot-tpl else SPL_BIN := u-boot-spl endif {% endcodeblock %}\nç”± 168 è¡Œ ä¸Šé¢çš„å®šä¹‰å¯ä»¥çŸ¥é“ u-boot-spl.bin å’Œ u-boot-spl-nodtb.bin æœ‰å…³ç³»ã€‚\næ¥ç€æŸ¥æ‰¾åˆ°ç¬¬223è¡Œï¼š\n$(obj)/$(SPL_BIN)-nodtb.bin: $(obj)/$(SPL_BIN) FORCE \t$(call if_changed,objcopy) u-boot-spl-nodtb.bin æ˜¯é€šè¿‡ objcopy å‘½ä»¤ç”± u-boot-spl ç”Ÿæˆã€‚\nå†çœ‹ç¬¬246è¡Œ:\n$(obj)/$(SPL_BIN): $(u-boot-spl-init) $(u-boot-spl-main) $(obj)/u-boot-spl.lds FORCE \t$(call if_changed,u-boot-spl) æ‰€ä»¥u-boot-spl æ˜¯ç”± u-boot-spl.lds é“¾æ¥æ–‡ä»¶ç”Ÿæˆçš„ ï¼Œä½†æ˜¯ç›®å½•ä¸‹é¢æœ‰å‡ ä¸ªu-boot-spl.ldsæ–‡ä»¶ï¼Œåˆ°åº•æ˜¯å“ªä¸ª lds æ–‡ä»¶å‘¢ï¼Œä¸Šé¢æ˜¯ $(obj)/u-boot-spl.ldsï¼Œ obj åœ¨ 1310 è¡Œ ç¼–è¯‘ u-boot-spl.bin çš„æ—¶å€™èµ‹å€¼ä¸º obj=splï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çœ‹ u-boot/spl/u-boot-spl.lds è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœä½ ä¹‹å‰æ²¡æœ‰ç¼–è¯‘è¿‡è¿™ä¸ªæ–‡ä»¶æ˜¯æ²¡æœ‰çš„ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯å¦‚ä½•ç”Ÿæˆçš„å‘¢ï¼Ÿæˆ‘ä»¬ç¨åå†çœ‹ï¼Œå…ˆçœ‹ lds æ–‡ä»¶çš„å†…å®¹ï¼š\nMEMORY { .sram : ORIGIN = 0x402F0400, LENGTH = (0x4030B800 - 0x402F0400) } MEMORY { .sdram : ORIGIN = 0x80a00000, LENGTH = 0x80000 } OUTPUT_FORMAT(\"elf32-littlearm\", \"elf32-littlearm\", \"elf32-littlearm\") OUTPUT_ARCH(arm) ENTRY(_start) SECTIONS {  .text :  {  __start = .;  *(.vectors)  arch/arm/cpu/armv7/start.o (.text)  *(.text*)  } .sram  . = ALIGN(4);  .rodata : { *(SORT_BY_ALIGNMENT(.rodata*)) } .sram  . = ALIGN(4);  .data : { *(SORT_BY_ALIGNMENT(.data*)) } .sram  .u_boot_list : {  KEEP(*(SORT(.u_boot_list*)));  } .sram  . = ALIGN(4);  __image_copy_end = .;  .end :  {  *(.__end)  } .sram  .bss :  {  . = ALIGN(4);  __bss_start = .;  *(.bss*)  . = ALIGN(4);  __bss_end = .;  } .sdram } é“¾æ¥æ–‡ä»¶é‡Œé¢è¯´æ˜äº†å†…å­˜å¸ƒå±€ï¼Œarch/arm/cpu/armv7/start.o ä»£ç æ®µéƒ½æ”¾åœ¨ SRAM ä¸­ï¼Œæ‰€ä»¥ arch/arm/cpu/armv7/start.S å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ä¸œè¥¿äº†ã€‚\nlds é“¾æ¥æ–‡ä»¶çš„ç”Ÿæˆ u-boot/spl/u-boot-spl.lds è¿™ä¸ªæ–‡ä»¶çš„ç”Ÿæˆåœ¨ u-boot/scripts/Makefile.spl æœ‰è§£é‡Š:\n$(obj)/u-boot-spl.lds: $(LDSCRIPT) FORCE \t$(call if_changed_dep,cpp_lds) LDSCRIPT çš„å®šä¹‰ï¼š\n# Linker Script ifdef CONFIG_SPL_LDSCRIPT # need to strip off double quotes LDSCRIPT := $(addprefix $(srctree)/,$(CONFIG_SPL_LDSCRIPT:\"%\"=%)) endif  ifeq ($(wildcard $(LDSCRIPT)),) \tLDSCRIPT := $(srctree)/board/$(BOARDDIR)/u-boot-spl.lds endif ifeq ($(wildcard $(LDSCRIPT)),) \tLDSCRIPT := $(srctree)/$(CPUDIR)/u-boot-spl.lds endif ifeq ($(wildcard $(LDSCRIPT)),) \tLDSCRIPT := $(srctree)/arch/$(ARCH)/cpu/u-boot-spl.lds endif ifeq ($(wildcard $(LDSCRIPT)),) $(error could not find linker script) endif å¯è§ Makefile.spl æ–‡ä»¶ä¸­å…ˆæ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰æŒ‡å®šçš„ lds æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šçš„ï¼Œå°±æŸ¥æ‰¾ board æ–‡ä»¶å¤¹ä¸­ç›®æ ‡æ¿ç›®å½•ä¸‹é¢æœ‰æ²¡æœ‰ lds æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å°±æŸ¥æ‰¾ç›¸åº”çš„ cpu ç›®å½•ï¼Œå› ä¸ºæˆ‘ä»¬ç›®æ ‡å™¨ä»¶æ˜¯ am335xï¼Œæ‰€ä»¥å‘ç°æœ‰ u-boot/arch/arm/cpu/armv7/am33xx/u-boot-spl.lds å†é€šè¿‡ cpp_lds å‘½ä»¤ç¼–è¯‘æˆï¼Œcpp_lds æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œå…·ä½“å®šä¹‰è¿˜æ˜¯åœ¨ Makefile.spl æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æŸ¥çœ‹ u-boot/arch/arm/cpu/armv7/am33xx/u-boot-spl.lds ä¹Ÿå‘ç° MLO æ–‡ä»¶ä»£ç æ˜¯åœ¨ start.S æ–‡ä»¶ä¸­ã€‚\nMLO ç¨‹åºåˆ†æ æŸ¥çœ‹ start.S åˆ†æä¸‹ MLO ç¨‹åºå…·ä½“çš„æ‰§è¡Œæµç¨‹ï¼ŒMLO çš„ makefile ä¼šæ ¹æ® CONFIG_SPL_BUILD ç¼–è¯‘ä¸åŒçš„æºæ–‡ä»¶ï¼ŒåŒæ ·çš„åœ¨æºç å†…ä¹Ÿé€šè¿‡ CONFIG_SPL_BUILD æ§åˆ¶ä¸åŒçš„ä»£ç æ‰§è¡Œï¼Œå‰é¢ä¸€éƒ¨åˆ† MLO æ–‡ä»¶å’Œ U-Boot æ˜¯ç±»ä¼¼çš„ï¼Œè¿›å…¥åˆ° _main å‡½æ•°ä¸­ä¸¤ä¸ªç¨‹åºçš„åŠŸèƒ½å°±å¼€å§‹å‡ºç°å·®å¼‚äº†ï¼š\nreset //(arch/arm/cpu/armv7/start.S) save_boot_params_ret //(arch/arm/cpu/armv7/start.S)  |- disable interrupts  |- cpu_init_cp15 //(arch/arm/cpu/armv7/start.S)  | |- Invalidate L1 I/D  | |- disable MMU stuff and caches  |- cpu_init_crit //(arch/arm/cpu/armv7/start.S)  | |- lowlevel_init //(arch/arm/cpu/armv7/lowlevel_init.S)  | |- Setup a temporary stack  | |- Set up global data  | |- s_init //(arch/arm/cpu/armv7/am33xx/board.c)  | |- watchdog_disable  | |- set_uart_mux_conf  | |- setup_clocks_for_console  | |- uart_soft_reset  |- _main //(arch/arm/lib/crt0.S)   |(MLO)å¦‚æœæ˜¯ MLO æ–‡ä»¶  |- board_init_f //(arch/arm/cpu/armv7/am33xx/board.c)  | |- board_early_init_f //(arch/arm/cpu/armv7/am33xx/board.c)  | | |- prcm_init  | | |- set_mux_conf_regs  | |- sdram_init //(board/ti/am335x/board.c) åˆå§‹åŒ– DDR  |- spl_relocate_stack_gd  |- board_init_r //(common/spl/spl.c)  |- ...  |- spl_load_image //æ ¹æ®ä¸åŒçš„å¯åŠ¨æ–¹å¼åŠ è½½ u-boot é•œåƒï¼Œ  |- jump_to_image_no_args //è¿›å…¥u-bootä»£ç è¿è¡Œ    |(U-Boot)å¦‚æœæ˜¯U-Boot é•œåƒ  |- board_init_f //(common/board_f.c)  | |- ...  | |- initcall_run_list(init_sequence_f)  | |- ...  |  |- relocate_code //(arch/arm/lib/relocate.S) ä»£ç é‡å®šä½  |- relocate_vectors //(arch/arm/lib/relocate.S) å‘é‡è¡¨é‡å®šä¹‰  |- Set up final (full) environment  |- board_init_r //(common/board_r.c)  |- initcall_run_list(init_sequence_r)//åˆå§‹åŒ–å„ç§å¤–è®¾  |- main_loop() å½“ U-Boot é‡å®šä½å¥½ä»£ç ã€å‘é‡è¡¨ä¹‹åï¼Œè¿è¡Œ board_init_r  å‡½æ•°ï¼Œæ­¤å‡½æ•°ä¼šè°ƒç”¨ init_sequence_r åˆ—è¡¨é‡Œé¢çš„å‡½æ•°åˆå§‹åŒ–å„ç§å¤–è®¾é©±åŠ¨ï¼Œæœ€ååœ¨ main_loop() å‡½æ•°ä¸­è¿è¡Œï¼ŒU-Boot æœ‰ä¸ª bootdelay å»¶æ—¶å¯åŠ¨ï¼Œå¦‚æœä¸æ‰‹åŠ¨åœæ­¢ U-Boot ä¼šè‡ªåŠ¨è¿è¡Œ bootcmd åŒ…å«çš„å‘½ä»¤ã€‚\nå†…æ ¸å¼•å¯¼è¿™éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è¯¦ç»†è®²è§£ã€‚\nU-Boot ç¼–è¯‘ ç¼–è¯‘ U-Boot ç¼–è¯‘ Uï¼Boot å‰æˆ‘ä»¬éœ€è¦å®‰è£…äº¤å‰ç¼–è¯‘å™¨ï¼š\n# sudo apt-get install gcc-arm-linux-gnueabihf ä¸‹è½½ U-Boot æºç ï¼š\n# git clone git://git.denx.de/u-boot.git å› ä¸º U-Boot å®˜æ–¹å·²ç»æ”¯æŒäº† Beaglebone Black æ‰€ä»¥é…ç½®æ–‡ä»¶ä¹Ÿå·²ç»è‡ªå¸¦äº†ï¼Œç¼–è¯‘è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š\n# make distclean # make am335x_boneblack_defconfig # ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- make ç‰‡åˆ»åä¼šç”Ÿæˆ MLO å’Œ u-boot.img æ–‡ä»¶ã€‚\né…ç½® U-Boot å‚æ•° æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é…ç½® U-Boot çš„ä¸€äº›å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ uEnv.txt å’Œ boot.src æ–‡ä»¶ã€‚ U-Boot å¯åŠ¨çš„æ—¶å€™ä¼šåœ¨å¯åŠ¨åˆ†åŒºå¯»æ‰¾è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚\n boot.scr: This file is a U-Boot script. It contains instructions for U-Boot. Using these instruction, the kernel is loaded into memory, and (optionally) a ramdisk is loaded. boot.scr can also pass parameters to the kernel. This file is a compiled script, and cannot be edited directly. In some cases, boot.scr loads further instructions and configuration parameters from a text file.\n uEnv.txt: A file with additional boot parameters. This file can be read by boot.scr, or by the boot sequence if there is no script file. uEnv.txt is a regular text file that can be edited. This file should have Unix line ending, so a compatible program must be used when editing this file.\nU-Boot å¯åŠ¨çš„æ—¶å€™å¦‚æœä¸æ‰“æ–­ä¼šè°ƒç”¨ bootcmd åŒ…å«çš„å‘½ä»¤æ¥æ‰§è¡Œï¼Œé€šå¸¸ bootcmd ä¼šè°ƒç”¨ bootscript è„šæœ¬ä¹Ÿå°±æ˜¯ boot.scr é‡Œé¢çš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼Œ boot.scr é€šå¸¸ä¹Ÿä¼šå…ˆè¯»å– uEnv.txt ç¡®å®šé¢å¤–å‚æ•°ï¼Œå› ä¸º boot.src æ–‡ä»¶å¿…é¡»é€šè¿‡ boot.cmd æ–‡ä»¶ç¼–è¯‘è€Œæ¥ï¼Œ uEnv.txt åˆ™æ˜¯å¯ä»¥ä»»æ„ç¼–è¾‘ï¼Œè¿™æ ·å¯é…ç½®æ€§å°±å¤§å¤§æé«˜äº†ã€‚å¦‚æœæ²¡æœ‰ boot.src æ–‡ä»¶ï¼ŒU-Boot æœ‰é»˜è®¤é…ç½®çš„ bootcmd å‘½ä»¤ã€‚\nåœ¨ Beagelbone Black ä¸­æˆ‘ä»¬ä¸éœ€è¦é¢å¤–çš„ boot.scr æ–‡ä»¶ï¼Œç”¨é»˜è®¤çš„å‘½ä»¤å³å¯ï¼Œé»˜è®¤çš„å‘½ä»¤ä¸ºï¼š\n#define CONFIG_BOOTCOMMAND \\ \"run findfdt; \" \\ \"run distro_bootcmd\" run distro_bootcmd æœ€ç»ˆä¼šè°ƒç”¨ run mmcboot å‘½ä»¤åŠ è½½ uEnv.txt æ–‡ä»¶ï¼Œå¹¶ä¸”ä¼šè¿è¡Œ uEnv.txt æ–‡ä»¶é‡Œé¢ uenvcmd æŒ‡ä»£çš„å‘½ä»¤ã€‚\nuEnv.txt ä»ç½‘ç»œå¯åŠ¨ä¾‹å­ï¼š\nconsole=ttyO0,115200n8 ipaddr=192.168.23.2 serverip=192.168.23.1 rootpath=/exports/rootfs netargs=setenv bootargs console=${console} ${optargs} root=/dev/nfs nfsroot=${serverip}:${rootpath},${nfsopts} rw ip=${ipaddr}:${serverip}:192.168.23.1:255.255.255.0:beaglebone:eth0:none:192.168.23.1 netboot=echo Booting from network ...; tftp ${loadaddr} ${bootfile}; tftp ${fdtaddr} ${fdtfile}; run netargs; bootz ${loadaddr} - ${fdtaddr} uenvcmd=run netboot åˆ¶ä½œ U-Boot çš„ SD å¯åŠ¨å¡ åˆ¶ä½œ SD å¯åŠ¨å¡ä¹‹å‰é¦–å…ˆéœ€è¦ä¸º SD å¡åˆ†åŒºï¼Œ ROM Code å¯åŠ¨çš„æ—¶å€™å¦‚æœæ˜¯ä» MMC è®¾å¤‡åŠ è½½å¯åŠ¨ä»£ç ï¼ŒROM Code ä¼šä»ç¬¬ä¸€ä¸ªæ´»åŠ¨åˆ†åŒºå¯»æ‰¾åä¸º â€œMLOâ€ çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æ­¤åˆ†åŒºå¿…é¡»ä¸º FATæ–‡ä»¶ç³»ç»Ÿã€‚æ‰€ä»¥åˆ¶ä½œ U-Boot çš„å¯åŠ¨å¡åªéœ€è¦ä¸€ä¸ªå¸¦æœ‰ MLO å’Œ U-Boot é•œåƒçš„ FAT æ ¼å¼çš„ SD å¡ï¼Œå¦‚æœéœ€è¦å¯åŠ¨ Linux å†…æ ¸è¿˜éœ€è¦åˆ«çš„åˆ†åŒºï¼Œæˆ‘ä»¬ä»¥åå†è®²ã€‚\næœ‰ä¸¤ç§æ–¹å¼å¯ä»¥åˆ¶ä½œåŒ…å« U-Boot çš„å¯å¯åŠ¨çš„ SD å¡ï¼Œä¸€ç§æ˜¯ç”¨ RAW Mode çš„æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç”¨ FTA çš„æ–¹å¼ã€‚\nRAW Mode å’Œçƒ§å†™æ–¹å¼åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢æœ‰è®²ï¼šè§£æ BeagleBone Black å®˜æ–¹é•œåƒã€‚\nFTA æ¨¡å¼ä¸‹åªè¦å»ºç«‹ä¸€ä¸ª FTA åˆ†åŒºå†æŠŠ MLO å’Œ uboot.img æ–‡ä»¶æ‹·è´è¿›å»å³å¯ã€‚\næˆ‘æ˜¯ä½¿ç”¨çš„ USB è¯»å¡å™¨ï¼Œæ’å…¥å Linux /dev/ ç›®å½•ä¼šæ˜¾ç¤º /dev/sd* è®¾å¤‡ï¼Œæˆ‘è¿™é‡Œå¤šå‡ºä¸¤ä¸ªè®¾å¤‡åˆ†åˆ«æ˜¾ç¤º /dev/sdb å’Œ /dev/sdb1 ï¼Œå…¶ä¸­ /dev/sdb è¡¨ç¤ºä¸€æ•´ä¸ªç‰©ç†ç£ç›˜ï¼Œ /dev/sdb1 è¡¨ç¤ºçš„æ˜¯å…·ä½“çš„åˆ†åŒºã€‚\nä½¿ç”¨å‘½ä»¤ sudo fdisk /dev/sdb ç®¡ç†ç£ç›˜:\na : toggle a bootable flagï¼ˆè®¾ç½®æˆ–å–æ¶ˆå¯åŠ¨è¡¨ç¤ºï¼‰\nb : edit bsd disklabelï¼ˆç¼–è¾‘ bsd disklabel)\nc : toggle the dos compatibility flag\nd : delete a partition ï¼ˆåˆ é™¤ä¸€ä¸ªåˆ†åŒºï¼‰\nl : list known partition types ï¼ˆåˆ—å‡ºå·²çŸ¥çš„åˆ†åŒºç±»å‹ï¼‰\nm : print this menu ï¼ˆæ‰“å°æ¬¡åˆ—è¡¨ï¼‰\nn : add a new partition ï¼ˆå¢åŠ ä¸€ä¸ªæ–°åˆ†åŒºï¼‰\no : create a new empty DOS partition table ï¼ˆå»ºç«‹ä¸€ä¸ªæ–°çš„ç©º DOS åˆ†åŒºè¡¨ï¼‰\np : print the partition table ï¼ˆæ‰“å°åˆ†åŒºè¡¨ï¼‰\nq : quit without saving changes ï¼ˆä¸ä¿å­˜é€€å‡ºï¼‰\ns : create a new empty Sun disklabel\nt : change a partitionâ€™s system id\nu : change display/entry units\nv : verify the partition table ï¼ˆéªŒè¯åˆ†åŒºè¡¨ï¼‰\nw : write table to disk and exit ï¼ˆæŠŠåˆ†åŒºè¡¨å†™å…¥ç£ç›˜ï¼‰\nx : extra functionality (experts only) ï¼ˆé¢å¤–çš„åŠŸèƒ½ï¼‰\næ–°å»ºå¯åŠ¨åˆ†åŒºï¼š\nCommand (m for help): p  Disk /dev/sdb: 7746 MB, 7746879488 bytes 24 heads, 20 sectors/track, 31522 cylinders, total 15130624 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x00000000   Device Boot Start End Blocks Id System /dev/sdb1 * 2048 15130623 7564288 c W95 FAT32 (LBA)  Command (m for help): m Command action  a toggle a bootable flag  b edit bsd disklabel  c toggle the dos compatibility flag  d delete a partition  l list known partition types  m print this menu  n add a new partition  o create a new empty DOS partition table  p print the partition table  q quit without saving changes  s create a new empty Sun disklabel  t change a partition's system id  u change display/entry units  v verify the partition table  w write table to disk and exit  x extra functionality (experts only)  Command (m for help): d Selected partition 1  Command (m for help): p  Disk /dev/sdb: 7746 MB, 7746879488 bytes 24 heads, 20 sectors/track, 31522 cylinders, total 15130624 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x00000000   Device Boot Start End Blocks Id System  Command (m for help): n Partition type:  p primary (0 primary, 0 extended, 4 free)  e extended Select (default p): p Partition number (1-4, default 1): Using default value 1 First sector (2048-15130623, default 2048): Using default value 2048 Last sector, +sectors or +size{K,M,G} (2048-15130623, default 15130623): Using default value 15130623  Command (m for help): p  Disk /dev/sdb: 7746 MB, 7746879488 bytes 24 heads, 20 sectors/track, 31522 cylinders, total 15130624 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x00000000   Device Boot Start End Blocks Id System /dev/sdb1 2048 15130623 7564288 83 Linux  Command (m for help): t Selected partition 1 Hex code (type L to list codes): c Changed system type of partition 1 to c (W95 FAT32 (LBA))  Command (m for help): a Partition number (1-4): 1  Command (m for help): p  Disk /dev/sdb: 7746 MB, 7746879488 bytes 24 heads, 20 sectors/track, 31522 cylinders, total 15130624 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x00000000   Device Boot Start End Blocks Id System /dev/sdb1 * 2048 15130623 7564288 c W95 FAT32 (LBA)  Command (m for help): w The partition table has been altered!  Calling ioctl() to re-read partition table.  WARNING: If you have created or modified any DOS 6.x partitions, please see the fdisk manual page for additional information. Syncing disks. å»ºç«‹å¥½æ–°çš„åˆ†åŒºä¹‹åéœ€è¦å‘½åå¹¶æ ¼å¼åŒ–ï¼š\n# sudo mkfs.vfat -F 32 -n boot /dev/sdb1 æ ¼å¼åŒ–ä¹‹åæŒ‚è½½ç£ç›˜å¹¶æŠŠ MLO æ–‡ä»¶å’Œ u-boot.img æ–‡ä»¶æ‹·è´è¿›å»ï¼š\n# sudo mount /dev/sdb1 /media/jg/boot  # sudo cp MLO /media/jg/boot/MLO # ls /media/jg/boot  MLO # sudo cp u-boot.img /media/jg/boot/u-boot.img # ls /media/jg/boot  MLO u-boot.img # sync  # sudo umount /media/jg/boot  æ¥ç€æŠŠ SD å¡æ’å…¥ Beaglebone Black å¹¶ä¸”æŒ‰ç€ S2 æŒ‰é’®ä¸Šç”µï¼Œä»ä¸²å£æ‰“å°å‡ºçš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ° U-Boot å·²ç»å¯ä»¥æ­£å¸¸å¯åŠ¨äº†ï¼š\nU-Boot SPL 2016.03-rc2-00084-g595af9d (Feb 29 2016 - 22:21:20) Trying to boot from MMC Card doesn't support part_switch MMC partition switch failed *** Warning - MMC partition switch failed, using default environment reading u-boot.img reading u-boot.img U-Boot 2016.03-rc2-00084-g595af9d (Feb 29 2016 - 22:21:20 +0800)  Watchdog enabled I2C: ready DRAM: 512 MiB MMC: OMAP SD/MMC: 0, OMAP SD/MMC: 1 *** Warning - bad CRC, using default environment Net:  not set. Validating first E-fuse MAC cpsw, usb_ether Press SPACE to abort autoboot in 2 seconds switch to partitions #0, OK mmc0 is current device Scanning mmc 0:1... switch to partitions #0, OK mmc0 is current device SD/MMC found on device 0 reading boot.scr ** Unable to read file boot.scr ** reading uEnv.txt ** Unable to read file uEnv.txt ** ** File not found /boot/zImage ** switch to partitions #0, OK mmc1(part 0) is current device Scanning mmc 1:1... switch to partitions #0, OK mmc1(part 0) is current device SD/MMC found on device 1 reading boot.scr ** Unable to read file boot.scr ** reading uEnv.txt ** Unable to read file uEnv.txt ** ** File not found /boot/zImage ** ## Error: \"bootcmd_nand0\" not defined cpsw Waiting for PHY auto negotiation to complete......... TIMEOUT ! BOOTP broadcast 1 BOOTP broadcast 2 BOOTP broadcast 3 BOOTP broadcast 4 å¯åŠ¨ä¹‹åï¼Œå‰é¢ä¸€æ®µæ‰“å°ä¿¡æ¯æ˜¯ MLO ç¨‹åºæ‰“å°å‡ºæ¥çš„ï¼Œè¯»å– U-Boot ä¹‹åå¼€å§‹è¿è¡Œå®Œæ•´çš„ U-Bootï¼Œä¹‹åç¨‹åºæ‰«æå„ä¸ªè®¾å¤‡è¯»å– boot.scr å’Œ uEnv.txt æ–‡ä»¶ï¼Œæ¥ç€å†è¯»å–æ˜¯å¦æœ‰ Linux å†…æ ¸å¯ä»¥è¿è¡Œã€‚\nå‚è€ƒèµ„æ–™  Beaglebone Blackâ€”â€”åˆ¶ä½œè‡ªå·±çš„SDå¯åŠ¨å¡ U-Boot on BeagleBone Black AM335x U-Boot Userâ€™s Guide Pandaboard bootload(uboot) å¯åŠ¨æµç¨‹æ¢ç©¶ u-bootå¯åŠ¨æµç¨‹   ",
  "wordCount" : "1768",
  "inLanguage": "en",
  "datePublished": "2016-03-22T20:57:50Z",
  "dateModified": "2016-03-22T20:57:50Z",
  "author":{
    "@type": "Person",
    "name": "X"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jesseguox.github.io/tinyx/post/BBB-Uboot/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "TinyX",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jesseguox.github.io/tinyx/" accesskey="h" title="TinyX ğŸ‘¾ (Alt + H)">TinyX ğŸ‘¾</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jesseguox.github.io/tinyx/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://jesseguox.github.io/tinyx/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://jesseguox.github.io/tinyx/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://jesseguox.github.io/tinyx/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://jesseguox.github.io/tinyx/">Home</a>&nbsp;Â»&nbsp;<a href="https://jesseguox.github.io/tinyx/post/">Posts</a></div>
    <h1 class="post-title">
      BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot)
    </h1>
    <div class="post-meta"><span title='2016-03-22 20:57:50 +0000 UTC'>March 22, 2016</span>&nbsp;Â·&nbsp;X

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%af-u-boot" aria-label="ä»€ä¹ˆæ˜¯ U-Boot">ä»€ä¹ˆæ˜¯ U-Boot</a></li>
                <li>
                    <a href="#mlo-%e5%8f%8a%e5%85%b6%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b" aria-label="MLO åŠå…¶å¯åŠ¨è¿‡ç¨‹">MLO åŠå…¶å¯åŠ¨è¿‡ç¨‹</a><ul>
                        
                <li>
                    <a href="#mlo-%e6%96%87%e4%bb%b6%e6%98%af%e5%a6%82%e4%bd%95%e7%bc%96%e8%af%91%e5%87%ba%e6%9d%a5%e7%9a%84" aria-label="MLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„">MLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„</a></li>
                <li>
                    <a href="#lds-%e9%93%be%e6%8e%a5%e6%96%87%e4%bb%b6%e7%9a%84%e7%94%9f%e6%88%90" aria-label="lds é“¾æ¥æ–‡ä»¶çš„ç”Ÿæˆ">lds é“¾æ¥æ–‡ä»¶çš„ç”Ÿæˆ</a></li>
                <li>
                    <a href="#mlo-%e7%a8%8b%e5%ba%8f%e5%88%86%e6%9e%90" aria-label="MLO ç¨‹åºåˆ†æ">MLO ç¨‹åºåˆ†æ</a></li></ul>
                </li>
                <li>
                    <a href="#u-boot-%e7%bc%96%e8%af%91" aria-label="U-Boot ç¼–è¯‘">U-Boot ç¼–è¯‘</a><ul>
                        
                <li>
                    <a href="#%e7%bc%96%e8%af%91-u-boot" aria-label="ç¼–è¯‘ U-Boot">ç¼–è¯‘ U-Boot</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae-u-boot-%e5%8f%82%e6%95%b0" aria-label="é…ç½® U-Boot å‚æ•°">é…ç½® U-Boot å‚æ•°</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%b6%e4%bd%9c-u-boot-%e7%9a%84-sd-%e5%90%af%e5%8a%a8%e5%8d%a1" aria-label="åˆ¶ä½œ U-Boot çš„ SD å¯åŠ¨å¡">åˆ¶ä½œ U-Boot çš„ SD å¯åŠ¨å¡</a></li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" aria-label="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>æ›´æ–°ï¼š2016-04-01</p>
<h2 id="ä»€ä¹ˆæ˜¯-u-boot">ä»€ä¹ˆæ˜¯ U-Boot<a hidden class="anchor" aria-hidden="true" href="#ä»€ä¹ˆæ˜¯-u-boot">#</a></h2>
<p>ç†Ÿæ‚‰åµŒå…¥å¼å¼€å‘çš„åº”è¯¥éƒ½å¬è¿‡å®ƒï¼ŒU-boot å°±æ˜¯å¯åŠ¨ç³»ç»Ÿå‰çš„ä¸€æ®µå¼•å¯¼ç¨‹åºï¼Œè™½ç„¶æ˜¯å¼•å¯¼ç¨‹åºï¼Œä½†æ˜¯åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚</p>
<p><strong>è¿™ä¸€ç¯‡ä¸»è¦è®²è§£å¦‚ä½•ä»æ— åˆ°æœ‰è¿è¡Œ U-Bootï¼Œå…³äº U-Boot å¼•å¯¼ Linux çš„éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è®²è§£ã€‚</strong></p>
<p>U-Boot ä¹‹å‰çš„ç‰ˆæœ¬ä»¥ç‰ˆæœ¬å·å‘½åå¦‚ï¼š0.1.0, 0.2.0 è¿™å‡ å¹´æ”¹ä¸ºäº†ä»¥æ—¶é—´å’Œæ—¥æœŸå‘½åï¼šU-Boot 2016.03ã€‚</p>
<p>ä½¿ç”¨ git è·å¾— U-Boot çš„æºç ï¼š</p>
<pre tabindex="0"><code>git clone git://git.denx.de/u-boot.git
</code></pre><p>ç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯ 2016.02 çš„ç‰ˆæœ¬ã€‚</p>
<!-- raw HTML omitted -->
<h2 id="mlo-åŠå…¶å¯åŠ¨è¿‡ç¨‹">MLO åŠå…¶å¯åŠ¨è¿‡ç¨‹<a hidden class="anchor" aria-hidden="true" href="#mlo-åŠå…¶å¯åŠ¨è¿‡ç¨‹">#</a></h2>
<p><a href="http://jexbat.com/2016/BBB-bootmode/">ä¸Šä¸€ç¯‡æ–‡ç« </a>ï¼Œæˆ‘ä»¬äº†è§£äº† BeagleBone æœ‰ä¸ª SPL è¿‡ç¨‹ï¼Œå°±åœ¨è¿™ä¸ªæ—¶å€™è¯»å– MLO æ–‡ä»¶ï¼ŒMLO æ–‡ä»¶å…¶å®æ˜¯ä¸ªç²¾ç®€ç‰ˆçš„ U-Bootï¼Œä¹Ÿæ˜¯ç”± U-Boot ç”Ÿæˆï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é™ï¼Œåªåˆå§‹åŒ–äº†éƒ¨åˆ†èµ„æºå¦‚ DDRï¼Œç„¶åå¯åŠ¨ U-Bootã€‚</p>
<h3 id="mlo-æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„">MLO æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„<a hidden class="anchor" aria-hidden="true" href="#mlo-æ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘å‡ºæ¥çš„">#</a></h3>
<p>åˆ†æ MLO çš„ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰éœ€è¦çŸ¥é“ç¼–è¯‘åŸç†å’Œ Makefile ç­‰ç›¸å…³çŸ¥è¯†ã€‚
æˆ‘ä»¬å…ˆæ‰¾æ‰¾ Makefile çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆã€‚å»ºè®®ä½¿ç”¨ <a href="https://www.sublimetext.com/">Sublime</a> ç¼–è¾‘å™¨ã€‚ç”¨å…¨å±€æŸ¥æ‰¾åŠŸèƒ½æŸ¥æ‰¾ MLO å…³é”®å­—ã€‚</p>
<p>æ‰¾åˆ° <code>u-boot/scripts/Makefile.spl</code> æ–‡ä»¶ <strong><code>117è¡Œ</code></strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#a6e22e">MLO MLO.byteswap</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>obj<span style="color:#66d9ef">)</span>/u-boot-spl.bin FORCE
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>call if_changed,mkimage<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° MLO æ–‡ä»¶æ˜¯ç”± <code>u-boot-spl.bin</code> æ–‡ä»¶é€šè¿‡ <code>mkimage</code> å‘½ä»¤ç”Ÿæˆçš„ã€‚
å†æŸ¥åˆ° <code>u-boot/Makefile</code> æ–‡ä»¶ <strong><code>1310 è¡Œ</code></strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#a6e22e">spl/u-boot-spl.bin</span><span style="color:#f92672">:</span> spl/u-boot-spl
</span></span><span style="display:flex;"><span>	@:
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spl/u-boot-spl</span><span style="color:#f92672">:</span> tools prepare <span style="color:#66d9ef">$(</span>if <span style="color:#66d9ef">$(</span>CONFIG_OF_SEPARATE<span style="color:#66d9ef">)</span>,dts/dt.dtb<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>Q<span style="color:#66d9ef">)$(</span>MAKE<span style="color:#66d9ef">)</span> obj<span style="color:#f92672">=</span>spl -f <span style="color:#66d9ef">$(</span>srctree<span style="color:#66d9ef">)</span>/scripts/Makefile.spl all
</span></span></code></pre></div><p><code>u-boot-spl.bin</code> æ–‡ä»¶æ˜¯è¿˜æ˜¯ç”± <code>u-boot/scripts/Makefile.spl</code> æ–‡ä»¶ç”Ÿæˆã€‚
æ–‡ä»¶ <code>u-boot/scripts/Makefile.spl</code> <strong><code>168 è¡Œ</code></strong> å®šä¹‰äº† <code>u-boot-spl.bin</code> çš„ç”Ÿæˆï¼š</p>
<pre tabindex="0"><code class="language-lang:make" data-lang="lang:make">ifeq ($(CONFIG_SPL_OF_CONTROL),y)
$(obj)/$(SPL_BIN)-dtb.bin: $(obj)/$(SPL_BIN)-nodtb.bin $(obj)/$(SPL_BIN)-pad.bin \
		$(obj)/$(SPL_BIN).dtb FORCE
	$(call if_changed,cat)

$(obj)/$(SPL_BIN).bin: $(obj)/$(SPL_BIN)-dtb.bin FORCE
	$(call if_changed,copy)
else
$(obj)/$(SPL_BIN).bin: $(obj)/$(SPL_BIN)-nodtb.bin FORCE
	$(call if_changed,copy)
endif
</code></pre><p>å› ä¸º <code>SPL_BIN</code> åœ¨ <strong><code>ç¬¬32è¡Œ</code></strong> å®šä¹‰ä¸º <code>u-boot-spl</code>:</p>
<p>{% codeblock lang:make u-boot/scripts/Makefile.spl %}
ifeq ($(CONFIG_TPL_BUILD),y)
SPL_BIN := u-boot-tpl
else
SPL_BIN := u-boot-spl
endif
{% endcodeblock %}</p>
<p>ç”± <strong><code>168 è¡Œ</code></strong> ä¸Šé¢çš„å®šä¹‰å¯ä»¥çŸ¥é“ <code>u-boot-spl.bin</code> å’Œ <code>u-boot-spl-nodtb.bin</code> æœ‰å…³ç³»ã€‚</p>
<p>æ¥ç€æŸ¥æ‰¾åˆ°<strong>ç¬¬223è¡Œ</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#a6e22e">$(obj)/$(SPL_BIN)-nodtb.bin</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>obj<span style="color:#66d9ef">)</span>/<span style="color:#66d9ef">$(</span>SPL_BIN<span style="color:#66d9ef">)</span> FORCE
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>call if_changed,objcopy<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p><code>u-boot-spl-nodtb.bin</code> æ˜¯é€šè¿‡ objcopy å‘½ä»¤ç”± <code>u-boot-spl</code> ç”Ÿæˆã€‚</p>
<p>å†çœ‹<strong>ç¬¬246è¡Œ</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#a6e22e">$(obj)/$(SPL_BIN)</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>u-boot-spl-init<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>u-boot-spl-main<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>obj<span style="color:#66d9ef">)</span>/u-boot-spl.lds FORCE
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>call if_changed,u-boot-spl<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>æ‰€ä»¥<code>u-boot-spl</code> æ˜¯ç”± <code>u-boot-spl.lds</code> é“¾æ¥æ–‡ä»¶ç”Ÿæˆçš„ ï¼Œä½†æ˜¯ç›®å½•ä¸‹é¢æœ‰å‡ ä¸ª<code>u-boot-spl.lds</code>æ–‡ä»¶ï¼Œåˆ°åº•æ˜¯å“ªä¸ª lds æ–‡ä»¶å‘¢ï¼Œä¸Šé¢æ˜¯ <code>$(obj)/u-boot-spl.lds</code>ï¼Œ <code>obj</code> åœ¨ <strong><code>1310 è¡Œ</code></strong> ç¼–è¯‘ <code>u-boot-spl.bin</code> çš„æ—¶å€™èµ‹å€¼ä¸º <code>obj=spl</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çœ‹ <code>u-boot/spl/u-boot-spl.lds</code> è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœä½ ä¹‹å‰æ²¡æœ‰ç¼–è¯‘è¿‡è¿™ä¸ªæ–‡ä»¶æ˜¯æ²¡æœ‰çš„ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯å¦‚ä½•ç”Ÿæˆçš„å‘¢ï¼Ÿæˆ‘ä»¬ç¨åå†çœ‹ï¼Œå…ˆçœ‹ lds æ–‡ä»¶çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gas" data-lang="gas"><span style="display:flex;"><span><span style="color:#a6e22e">MEMORY</span> <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#66d9ef">.sram</span> : <span style="color:#66d9ef">ORIGIN</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">0x402F0400</span>, <span style="color:#66d9ef">LENGTH</span> <span style="color:#960050;background-color:#1e0010">=</span> (<span style="color:#ae81ff">0x4030B800</span> - <span style="color:#ae81ff">0x402F0400</span>) <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MEMORY</span> <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#66d9ef">.sdram</span> : <span style="color:#66d9ef">ORIGIN</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">0x80a00000</span>, <span style="color:#66d9ef">LENGTH</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">0x80000</span> <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">OUTPUT_FORMAT</span>(<span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">elf32-littlearm</span><span style="color:#960050;background-color:#1e0010">&#34;</span>, <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">elf32-littlearm</span><span style="color:#960050;background-color:#1e0010">&#34;</span>, <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">elf32-littlearm</span><span style="color:#960050;background-color:#1e0010">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">OUTPUT_ARCH</span>(<span style="color:#66d9ef">arm</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ENTRY</span>(<span style="color:#66d9ef">_start</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SECTIONS</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">.text</span> :
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">__start</span> <span style="color:#960050;background-color:#1e0010">=</span> .<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  *(.<span style="color:#66d9ef">vectors</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">arch</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">arm</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">cpu</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">armv7</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">start.o</span> (.<span style="color:#66d9ef">text</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">*(</span><span style="color:#a6e22e">.text</span>*)
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">&gt;</span><span style="color:#a6e22e">.sram</span>
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">.</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#a6e22e">ALIGN</span>(<span style="color:#ae81ff">4</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#66d9ef">.rodata</span> : <span style="color:#960050;background-color:#1e0010">{</span> *(<span style="color:#66d9ef">SORT_BY_ALIGNMENT</span>(.<span style="color:#66d9ef">rodata</span>*)) <span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">&gt;</span><span style="color:#66d9ef">.sram</span>
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">.</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#a6e22e">ALIGN</span>(<span style="color:#ae81ff">4</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#66d9ef">.data</span> : <span style="color:#960050;background-color:#1e0010">{</span> *(<span style="color:#66d9ef">SORT_BY_ALIGNMENT</span>(.<span style="color:#66d9ef">data</span>*)) <span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">&gt;</span><span style="color:#66d9ef">.sram</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">.u_boot_list</span> : <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">KEEP</span>(*(<span style="color:#66d9ef">SORT</span>(.<span style="color:#66d9ef">u_boot_list</span>*)))<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">&gt;</span><span style="color:#66d9ef">.sram</span>
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">.</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#a6e22e">ALIGN</span>(<span style="color:#ae81ff">4</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#66d9ef">__image_copy_end</span> <span style="color:#960050;background-color:#1e0010">=</span> .<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#66d9ef">.end</span> :
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">*(</span><span style="color:#a6e22e">.__end</span>)
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">&gt;</span><span style="color:#a6e22e">.sram</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">.bss</span> :
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">.</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#a6e22e">ALIGN</span>(<span style="color:#ae81ff">4</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">__bss_start</span> <span style="color:#960050;background-color:#1e0010">=</span> .<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  *(.<span style="color:#66d9ef">bss</span>*)
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">.</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#a6e22e">ALIGN</span>(<span style="color:#ae81ff">4</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">__bss_end</span> <span style="color:#960050;background-color:#1e0010">=</span> .<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">&gt;</span><span style="color:#66d9ef">.sdram</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>é“¾æ¥æ–‡ä»¶é‡Œé¢è¯´æ˜äº†å†…å­˜å¸ƒå±€ï¼Œ<code>arch/arm/cpu/armv7/start.o</code> ä»£ç æ®µéƒ½æ”¾åœ¨ SRAM ä¸­ï¼Œæ‰€ä»¥ <code>arch/arm/cpu/armv7/start.S</code> å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ä¸œè¥¿äº†ã€‚</p>
<h3 id="lds-é“¾æ¥æ–‡ä»¶çš„ç”Ÿæˆ">lds é“¾æ¥æ–‡ä»¶çš„ç”Ÿæˆ<a hidden class="anchor" aria-hidden="true" href="#lds-é“¾æ¥æ–‡ä»¶çš„ç”Ÿæˆ">#</a></h3>
<p><code>u-boot/spl/u-boot-spl.lds</code> è¿™ä¸ªæ–‡ä»¶çš„ç”Ÿæˆåœ¨ <code>u-boot/scripts/Makefile.spl</code> æœ‰è§£é‡Š:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#a6e22e">$(obj)/u-boot-spl.lds</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>LDSCRIPT<span style="color:#66d9ef">)</span> FORCE
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>call if_changed_dep,cpp_lds<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p><code>LDSCRIPT</code> çš„å®šä¹‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#75715e"># Linker Script
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">ifdef</span> <span style="color:#960050;background-color:#1e0010">CONFIG_SPL_LDSCRIPT</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># need to strip off double quotes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>LDSCRIPT <span style="color:#f92672">:=</span> <span style="color:#66d9ef">$(</span>addprefix <span style="color:#66d9ef">$(</span>srctree<span style="color:#66d9ef">)</span>/,<span style="color:#66d9ef">$(</span>CONFIG_SPL_LDSCRIPT:<span style="color:#e6db74">&#34;%&#34;</span><span style="color:#f92672">=</span>%<span style="color:#66d9ef">))</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifeq</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#66d9ef">$(</span>wildcard <span style="color:#66d9ef">$(</span>LDSCRIPT<span style="color:#66d9ef">))</span><span style="color:#960050;background-color:#1e0010">,)</span>
</span></span><span style="display:flex;"><span>	LDSCRIPT <span style="color:#f92672">:=</span> <span style="color:#66d9ef">$(</span>srctree<span style="color:#66d9ef">)</span>/board/<span style="color:#66d9ef">$(</span>BOARDDIR<span style="color:#66d9ef">)</span>/u-boot-spl.lds
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifeq</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#66d9ef">$(</span>wildcard <span style="color:#66d9ef">$(</span>LDSCRIPT<span style="color:#66d9ef">))</span><span style="color:#960050;background-color:#1e0010">,)</span>
</span></span><span style="display:flex;"><span>	LDSCRIPT <span style="color:#f92672">:=</span> <span style="color:#66d9ef">$(</span>srctree<span style="color:#66d9ef">)</span>/<span style="color:#66d9ef">$(</span>CPUDIR<span style="color:#66d9ef">)</span>/u-boot-spl.lds
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifeq</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#66d9ef">$(</span>wildcard <span style="color:#66d9ef">$(</span>LDSCRIPT<span style="color:#66d9ef">))</span><span style="color:#960050;background-color:#1e0010">,)</span>
</span></span><span style="display:flex;"><span>	LDSCRIPT <span style="color:#f92672">:=</span> <span style="color:#66d9ef">$(</span>srctree<span style="color:#66d9ef">)</span>/arch/<span style="color:#66d9ef">$(</span>ARCH<span style="color:#66d9ef">)</span>/cpu/u-boot-spl.lds
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifeq</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#66d9ef">$(</span>wildcard <span style="color:#66d9ef">$(</span>LDSCRIPT<span style="color:#66d9ef">))</span><span style="color:#960050;background-color:#1e0010">,)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">$(</span>error could not find linker script<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span></code></pre></div><p>å¯è§ <code>Makefile.spl</code> æ–‡ä»¶ä¸­å…ˆæ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰æŒ‡å®šçš„ lds æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šçš„ï¼Œå°±æŸ¥æ‰¾ board æ–‡ä»¶å¤¹ä¸­ç›®æ ‡æ¿ç›®å½•ä¸‹é¢æœ‰æ²¡æœ‰ lds æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å°±æŸ¥æ‰¾ç›¸åº”çš„ cpu ç›®å½•ï¼Œå› ä¸ºæˆ‘ä»¬ç›®æ ‡å™¨ä»¶æ˜¯ am335xï¼Œæ‰€ä»¥å‘ç°æœ‰ <code>u-boot/arch/arm/cpu/armv7/am33xx/u-boot-spl.lds</code> å†é€šè¿‡ <code>cpp_lds</code> å‘½ä»¤ç¼–è¯‘æˆï¼Œ<code>cpp_lds</code> æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œå…·ä½“å®šä¹‰è¿˜æ˜¯åœ¨ <code>Makefile.spl</code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æŸ¥çœ‹ <code>u-boot/arch/arm/cpu/armv7/am33xx/u-boot-spl.lds</code> ä¹Ÿå‘ç° MLO æ–‡ä»¶ä»£ç æ˜¯åœ¨ <code>start.S</code> æ–‡ä»¶ä¸­ã€‚</p>
<h3 id="mlo-ç¨‹åºåˆ†æ">MLO ç¨‹åºåˆ†æ<a hidden class="anchor" aria-hidden="true" href="#mlo-ç¨‹åºåˆ†æ">#</a></h3>
<p>æŸ¥çœ‹ <code>start.S</code> åˆ†æä¸‹ MLO ç¨‹åºå…·ä½“çš„æ‰§è¡Œæµç¨‹ï¼ŒMLO çš„ makefile ä¼šæ ¹æ® <code>CONFIG_SPL_BUILD</code> ç¼–è¯‘ä¸åŒçš„æºæ–‡ä»¶ï¼ŒåŒæ ·çš„åœ¨æºç å†…ä¹Ÿé€šè¿‡ <code>CONFIG_SPL_BUILD</code> æ§åˆ¶ä¸åŒçš„ä»£ç æ‰§è¡Œï¼Œå‰é¢ä¸€éƒ¨åˆ† MLO æ–‡ä»¶å’Œ U-Boot æ˜¯ç±»ä¼¼çš„ï¼Œè¿›å…¥åˆ° <code>_main</code> å‡½æ•°ä¸­ä¸¤ä¸ªç¨‹åºçš„åŠŸèƒ½å°±å¼€å§‹å‡ºç°å·®å¼‚äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>reset <span style="color:#75715e">//(arch/arm/cpu/armv7/start.S)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>save_boot_params_ret <span style="color:#75715e">//(arch/arm/cpu/armv7/start.S)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">|-</span> disable interrupts 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|-</span> cpu_init_cp15 <span style="color:#75715e">//(arch/arm/cpu/armv7/start.S)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> Invalidate L1 I<span style="color:#f92672">/</span>D
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> disable MMU stuff and caches
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|-</span> cpu_init_crit <span style="color:#75715e">//(arch/arm/cpu/armv7/start.S)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> lowlevel_init <span style="color:#75715e">//(arch/arm/cpu/armv7/lowlevel_init.S)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">|</span>       <span style="color:#f92672">|-</span> Setup a temporary stack
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>       <span style="color:#f92672">|-</span> Set up global data 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>       <span style="color:#f92672">|-</span> s_init <span style="color:#75715e">//(arch/arm/cpu/armv7/am33xx/board.c)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">|</span>           <span style="color:#f92672">|-</span> watchdog_disable
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>           <span style="color:#f92672">|-</span> set_uart_mux_conf
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>           <span style="color:#f92672">|-</span> setup_clocks_for_console
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>           <span style="color:#f92672">|-</span> uart_soft_reset
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|-</span> _main <span style="color:#75715e">//(arch/arm/lib/crt0.S)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  	  
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|</span>(MLO)<span style="color:#960050;background-color:#1e0010">å¦‚æœæ˜¯</span> MLO <span style="color:#960050;background-color:#1e0010">æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|-</span> board_init_f <span style="color:#75715e">//(arch/arm/cpu/armv7/am33xx/board.c)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> board_early_init_f <span style="color:#75715e">//(arch/arm/cpu/armv7/am33xx/board.c)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#f92672">|</span>   <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> prcm_init
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|</span>   <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> set_mux_conf_regs
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> sdram_init <span style="color:#75715e">//(board/ti/am335x/board.c) åˆå§‹åŒ– DDR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#f92672">|-</span> spl_relocate_stack_gd
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|-</span> board_init_r <span style="color:#75715e">//(common/spl/spl.c)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#f92672">|-</span> ...
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">|-</span> spl_load_image <span style="color:#75715e">//æ ¹æ®ä¸åŒçš„å¯åŠ¨æ–¹å¼åŠ è½½ u-boot é•œåƒï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#f92672">|-</span> jump_to_image_no_args <span style="color:#75715e">//è¿›å…¥u-bootä»£ç è¿è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  	  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|</span>(U<span style="color:#f92672">-</span>Boot)<span style="color:#960050;background-color:#1e0010">å¦‚æœæ˜¯</span>U<span style="color:#f92672">-</span>Boot <span style="color:#960050;background-color:#1e0010">é•œåƒ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|-</span> board_init_f <span style="color:#75715e">//(common/board_f.c)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> ...
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> initcall_run_list(init_sequence_f)   
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|</span>   <span style="color:#f92672">|-</span> ...   
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|</span>   
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|-</span> relocate_code <span style="color:#75715e">//(arch/arm/lib/relocate.S) ä»£ç é‡å®šä½
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#f92672">|-</span> relocate_vectors <span style="color:#75715e">//(arch/arm/lib/relocate.S) å‘é‡è¡¨é‡å®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#f92672">|-</span> Set up final (full) environment 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|-</span> board_init_r <span style="color:#75715e">//(common/board_r.c)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#f92672">|-</span> initcall_run_list(init_sequence_r)<span style="color:#75715e">//åˆå§‹åŒ–å„ç§å¤–è®¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#f92672">|-</span> main_loop()
</span></span></code></pre></div><p>å½“ U-Boot é‡å®šä½å¥½ä»£ç ã€å‘é‡è¡¨ä¹‹åï¼Œè¿è¡Œ <code>board_init_r </code> å‡½æ•°ï¼Œæ­¤å‡½æ•°ä¼šè°ƒç”¨ <code>init_sequence_r</code> åˆ—è¡¨é‡Œé¢çš„å‡½æ•°åˆå§‹åŒ–å„ç§å¤–è®¾é©±åŠ¨ï¼Œæœ€ååœ¨ <code>main_loop()</code> å‡½æ•°ä¸­è¿è¡Œï¼ŒU-Boot æœ‰ä¸ª <code>bootdelay</code> å»¶æ—¶å¯åŠ¨ï¼Œå¦‚æœä¸æ‰‹åŠ¨åœæ­¢ U-Boot ä¼šè‡ªåŠ¨è¿è¡Œ <code>bootcmd</code> åŒ…å«çš„å‘½ä»¤ã€‚</p>
<p><strong>å†…æ ¸å¼•å¯¼è¿™éƒ¨åˆ†æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è¯¦ç»†è®²è§£ã€‚</strong></p>
<h2 id="u-boot-ç¼–è¯‘">U-Boot ç¼–è¯‘<a hidden class="anchor" aria-hidden="true" href="#u-boot-ç¼–è¯‘">#</a></h2>
<h3 id="ç¼–è¯‘-u-boot">ç¼–è¯‘ U-Boot<a hidden class="anchor" aria-hidden="true" href="#ç¼–è¯‘-u-boot">#</a></h3>
<p>ç¼–è¯‘ Uï¼Boot å‰æˆ‘ä»¬éœ€è¦å®‰è£…äº¤å‰ç¼–è¯‘å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span># sudo apt-get install gcc-arm-linux-gnueabihf
</span></span></code></pre></div><p>ä¸‹è½½ U-Boot æºç ï¼š</p>
<pre tabindex="0"><code># git clone git://git.denx.de/u-boot.git 
</code></pre><p>å› ä¸º U-Boot å®˜æ–¹å·²ç»æ”¯æŒäº† Beaglebone Black æ‰€ä»¥é…ç½®æ–‡ä»¶ä¹Ÿå·²ç»è‡ªå¸¦äº†ï¼Œç¼–è¯‘è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre tabindex="0"><code># make distclean
# make am335x_boneblack_defconfig
# ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- make
</code></pre><p>ç‰‡åˆ»åä¼šç”Ÿæˆ <code>MLO</code> å’Œ <code>u-boot.img</code> æ–‡ä»¶ã€‚</p>
<h3 id="é…ç½®-u-boot-å‚æ•°">é…ç½® U-Boot å‚æ•°<a hidden class="anchor" aria-hidden="true" href="#é…ç½®-u-boot-å‚æ•°">#</a></h3>
<p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é…ç½® U-Boot çš„ä¸€äº›å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ <code>uEnv.txt</code> å’Œ <code>boot.src</code> æ–‡ä»¶ã€‚
U-Boot å¯åŠ¨çš„æ—¶å€™ä¼šåœ¨å¯åŠ¨åˆ†åŒºå¯»æ‰¾è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>
<blockquote>
<p>boot.scr: This file is a U-Boot script. It contains instructions for U-Boot. Using these instruction, the kernel is loaded into memory, and (optionally) a ramdisk is loaded. boot.scr can also pass parameters to the kernel. This file is a compiled script, and cannot be edited directly. In some cases, boot.scr loads further instructions and configuration parameters from a text file.</p>
</blockquote>
<p>uEnv.txt: A file with additional boot parameters. This file can be read by boot.scr, or by the boot sequence if there is no script file. uEnv.txt is a regular text file that can be edited. This file should have Unix line ending, so a compatible program must be used when editing this file.</p>
<p>U-Boot å¯åŠ¨çš„æ—¶å€™å¦‚æœä¸æ‰“æ–­ä¼šè°ƒç”¨ <code>bootcmd</code> åŒ…å«çš„å‘½ä»¤æ¥æ‰§è¡Œï¼Œé€šå¸¸ <code>bootcmd</code> ä¼šè°ƒç”¨ bootscript è„šæœ¬ä¹Ÿå°±æ˜¯ <code>boot.scr</code> é‡Œé¢çš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼Œ <code>boot.scr</code> é€šå¸¸ä¹Ÿä¼šå…ˆè¯»å– <code>uEnv.txt</code> ç¡®å®šé¢å¤–å‚æ•°ï¼Œå› ä¸º <code>boot.src</code> æ–‡ä»¶å¿…é¡»é€šè¿‡ <code>boot.cmd</code> æ–‡ä»¶ç¼–è¯‘è€Œæ¥ï¼Œ <code>uEnv.txt</code> åˆ™æ˜¯å¯ä»¥ä»»æ„ç¼–è¾‘ï¼Œè¿™æ ·å¯é…ç½®æ€§å°±å¤§å¤§æé«˜äº†ã€‚å¦‚æœæ²¡æœ‰ <code>boot.src</code> æ–‡ä»¶ï¼ŒU-Boot æœ‰é»˜è®¤é…ç½®çš„ <code>bootcmd</code> å‘½ä»¤ã€‚</p>
<p>åœ¨ Beagelbone Black ä¸­æˆ‘ä»¬ä¸éœ€è¦é¢å¤–çš„ <code>boot.scr</code> æ–‡ä»¶ï¼Œç”¨é»˜è®¤çš„å‘½ä»¤å³å¯ï¼Œé»˜è®¤çš„å‘½ä»¤ä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-u-boot/include/configs/am335x_evm.h" data-lang="u-boot/include/configs/am335x_evm.h"><span style="display:flex;"><span><span style="color:#75715e">#define CONFIG_BOOTCOMMAND \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;run findfdt; &#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;run distro_bootcmd&#34;
</span></span></span></code></pre></div><p><code>run distro_bootcmd</code> æœ€ç»ˆä¼šè°ƒç”¨ <code>run mmcboot</code> å‘½ä»¤åŠ è½½ <code>uEnv.txt</code> æ–‡ä»¶ï¼Œå¹¶ä¸”ä¼šè¿è¡Œ <code>uEnv.txt</code> æ–‡ä»¶é‡Œé¢ <code>uenvcmd</code> æŒ‡ä»£çš„å‘½ä»¤ã€‚</p>
<p><code>uEnv.txt</code> ä»ç½‘ç»œå¯åŠ¨ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-uEnv.txt" data-lang="uEnv.txt"><span style="display:flex;"><span>console=ttyO0,115200n8
</span></span><span style="display:flex;"><span>ipaddr=192.168.23.2
</span></span><span style="display:flex;"><span>serverip=192.168.23.1
</span></span><span style="display:flex;"><span>rootpath=/exports/rootfs
</span></span><span style="display:flex;"><span>netargs=setenv bootargs console=${console} ${optargs} root=/dev/nfs nfsroot=${serverip}:${rootpath},${nfsopts} rw ip=${ipaddr}:${serverip}:192.168.23.1:255.255.255.0:beaglebone:eth0:none:192.168.23.1
</span></span><span style="display:flex;"><span>netboot=echo Booting from network ...; tftp ${loadaddr} ${bootfile}; tftp ${fdtaddr} ${fdtfile}; run netargs; bootz ${loadaddr} - ${fdtaddr}
</span></span><span style="display:flex;"><span>uenvcmd=run netboot
</span></span></code></pre></div><h2 id="åˆ¶ä½œ-u-boot-çš„-sd-å¯åŠ¨å¡">åˆ¶ä½œ U-Boot çš„ SD å¯åŠ¨å¡<a hidden class="anchor" aria-hidden="true" href="#åˆ¶ä½œ-u-boot-çš„-sd-å¯åŠ¨å¡">#</a></h2>
<p>åˆ¶ä½œ SD å¯åŠ¨å¡ä¹‹å‰é¦–å…ˆéœ€è¦ä¸º SD å¡åˆ†åŒºï¼Œ ROM Code å¯åŠ¨çš„æ—¶å€™å¦‚æœæ˜¯ä» MMC è®¾å¤‡åŠ è½½å¯åŠ¨ä»£ç ï¼ŒROM Code ä¼šä»ç¬¬ä¸€ä¸ªæ´»åŠ¨åˆ†åŒºå¯»æ‰¾åä¸º &ldquo;MLO&rdquo; çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æ­¤åˆ†åŒºå¿…é¡»ä¸º FATæ–‡ä»¶ç³»ç»Ÿã€‚æ‰€ä»¥åˆ¶ä½œ U-Boot çš„å¯åŠ¨å¡åªéœ€è¦ä¸€ä¸ªå¸¦æœ‰ MLO å’Œ U-Boot é•œåƒçš„ FAT æ ¼å¼çš„ SD å¡ï¼Œ<strong>å¦‚æœéœ€è¦å¯åŠ¨ Linux å†…æ ¸è¿˜éœ€è¦åˆ«çš„åˆ†åŒº</strong>ï¼Œæˆ‘ä»¬ä»¥åå†è®²ã€‚</p>
<p><strong>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥åˆ¶ä½œåŒ…å« U-Boot çš„å¯å¯åŠ¨çš„ SD å¡ï¼Œä¸€ç§æ˜¯ç”¨ RAW Mode çš„æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç”¨ FTA çš„æ–¹å¼ã€‚</strong></p>
<p>RAW Mode å’Œçƒ§å†™æ–¹å¼åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢æœ‰è®²ï¼š<a href="http://jexbat.com/2016/BeagleBone-Image/">è§£æ BeagleBone Black å®˜æ–¹é•œåƒ</a>ã€‚</p>
<p>FTA æ¨¡å¼ä¸‹åªè¦å»ºç«‹ä¸€ä¸ª FTA åˆ†åŒºå†æŠŠ MLO å’Œ uboot.img æ–‡ä»¶æ‹·è´è¿›å»å³å¯ã€‚</p>
<p>æˆ‘æ˜¯ä½¿ç”¨çš„ USB è¯»å¡å™¨ï¼Œæ’å…¥å Linux <code>/dev/</code> ç›®å½•ä¼šæ˜¾ç¤º <code>/dev/sd*</code> è®¾å¤‡ï¼Œæˆ‘è¿™é‡Œå¤šå‡ºä¸¤ä¸ªè®¾å¤‡åˆ†åˆ«æ˜¾ç¤º <code>/dev/sdb</code> å’Œ <code>/dev/sdb1</code> ï¼Œå…¶ä¸­ <code>/dev/sdb</code> è¡¨ç¤ºä¸€æ•´ä¸ªç‰©ç†ç£ç›˜ï¼Œ <code>/dev/sdb1</code> è¡¨ç¤ºçš„æ˜¯å…·ä½“çš„åˆ†åŒºã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤ <code>sudo fdisk /dev/sdb</code> ç®¡ç†ç£ç›˜:</p>
<p><code>a</code> : toggle a bootable flagï¼ˆè®¾ç½®æˆ–å–æ¶ˆå¯åŠ¨è¡¨ç¤ºï¼‰</p>
<p><code>b</code> : edit bsd disklabelï¼ˆç¼–è¾‘ bsd disklabel)</p>
<p><code>c</code> : toggle the dos compatibility flag</p>
<p><code>d</code> : delete a partition ï¼ˆåˆ é™¤ä¸€ä¸ªåˆ†åŒºï¼‰</p>
<p><code>l</code> : list known partition types ï¼ˆåˆ—å‡ºå·²çŸ¥çš„åˆ†åŒºç±»å‹ï¼‰</p>
<p><code>m</code> : print this menu ï¼ˆæ‰“å°æ¬¡åˆ—è¡¨ï¼‰</p>
<p><code>n</code> : add a new partition ï¼ˆå¢åŠ ä¸€ä¸ªæ–°åˆ†åŒºï¼‰</p>
<p><code>o</code> : create a new empty DOS partition table ï¼ˆå»ºç«‹ä¸€ä¸ªæ–°çš„ç©º DOS åˆ†åŒºè¡¨ï¼‰</p>
<p><code>p</code> : print the partition table ï¼ˆæ‰“å°åˆ†åŒºè¡¨ï¼‰</p>
<p><code>q</code> : quit without saving changes ï¼ˆä¸ä¿å­˜é€€å‡ºï¼‰</p>
<p><code>s</code> : create a new empty Sun disklabel</p>
<p><code>t</code> : change a partition&rsquo;s system id</p>
<p><code>u</code> : change display/entry units</p>
<p><code>v</code> : verify the partition table ï¼ˆéªŒè¯åˆ†åŒºè¡¨ï¼‰</p>
<p><code>w</code> : write table to disk and exit ï¼ˆæŠŠåˆ†åŒºè¡¨å†™å…¥ç£ç›˜ï¼‰</p>
<p><code>x</code> : extra functionality (experts only) ï¼ˆé¢å¤–çš„åŠŸèƒ½ï¼‰</p>
<p>æ–°å»ºå¯åŠ¨åˆ†åŒºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disk /dev/sdb: <span style="color:#ae81ff">7746</span> MB, <span style="color:#ae81ff">7746879488</span> bytes
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">24</span> heads, <span style="color:#ae81ff">20</span> sectors/track, <span style="color:#ae81ff">31522</span> cylinders, total <span style="color:#ae81ff">15130624</span> sectors
</span></span><span style="display:flex;"><span>Units <span style="color:#f92672">=</span> sectors of <span style="color:#ae81ff">1</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Disk identifier: 0x00000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Device Boot      Start         End      Blocks   Id  System
</span></span><span style="display:flex;"><span>/dev/sdb1   *        <span style="color:#ae81ff">2048</span>    <span style="color:#ae81ff">15130623</span>     <span style="color:#ae81ff">7564288</span>    c  W95 FAT32 <span style="color:#f92672">(</span>LBA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: m
</span></span><span style="display:flex;"><span>Command action
</span></span><span style="display:flex;"><span>   a   toggle a bootable flag
</span></span><span style="display:flex;"><span>   b   edit bsd disklabel
</span></span><span style="display:flex;"><span>   c   toggle the dos compatibility flag
</span></span><span style="display:flex;"><span>   d   delete a partition
</span></span><span style="display:flex;"><span>   l   list known partition types
</span></span><span style="display:flex;"><span>   m   print this menu
</span></span><span style="display:flex;"><span>   n   add a new partition
</span></span><span style="display:flex;"><span>   o   create a new empty DOS partition table
</span></span><span style="display:flex;"><span>   p   print the partition table
</span></span><span style="display:flex;"><span>   q   quit without saving changes
</span></span><span style="display:flex;"><span>   s   create a new empty Sun disklabel
</span></span><span style="display:flex;"><span>   t   change a partition<span style="color:#960050;background-color:#1e0010">&#39;</span>s system id
</span></span><span style="display:flex;"><span>   u   change display/entry units
</span></span><span style="display:flex;"><span>   v   verify the partition table
</span></span><span style="display:flex;"><span>   w   write table to disk and exit
</span></span><span style="display:flex;"><span>   x   extra functionality <span style="color:#f92672">(</span>experts only<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: d
</span></span><span style="display:flex;"><span>Selected partition <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disk /dev/sdb: <span style="color:#ae81ff">7746</span> MB, <span style="color:#ae81ff">7746879488</span> bytes
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">24</span> heads, <span style="color:#ae81ff">20</span> sectors/track, <span style="color:#ae81ff">31522</span> cylinders, total <span style="color:#ae81ff">15130624</span> sectors
</span></span><span style="display:flex;"><span>Units <span style="color:#f92672">=</span> sectors of <span style="color:#ae81ff">1</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Disk identifier: 0x00000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Device Boot      Start         End      Blocks   Id  System
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: n
</span></span><span style="display:flex;"><span>Partition type:
</span></span><span style="display:flex;"><span>   p   primary <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> primary, <span style="color:#ae81ff">0</span> extended, <span style="color:#ae81ff">4</span> free<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   e   extended
</span></span><span style="display:flex;"><span>Select <span style="color:#f92672">(</span>default p<span style="color:#f92672">)</span>: p
</span></span><span style="display:flex;"><span>Partition number <span style="color:#f92672">(</span>1-4, default 1<span style="color:#f92672">)</span>: 
</span></span><span style="display:flex;"><span>Using default value <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>First sector <span style="color:#f92672">(</span>2048-15130623, default 2048<span style="color:#f92672">)</span>: 
</span></span><span style="display:flex;"><span>Using default value <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>Last sector, +sectors or +size<span style="color:#f92672">{</span>K,M,G<span style="color:#f92672">}</span> <span style="color:#f92672">(</span>2048-15130623, default 15130623<span style="color:#f92672">)</span>: 
</span></span><span style="display:flex;"><span>Using default value <span style="color:#ae81ff">15130623</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disk /dev/sdb: <span style="color:#ae81ff">7746</span> MB, <span style="color:#ae81ff">7746879488</span> bytes
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">24</span> heads, <span style="color:#ae81ff">20</span> sectors/track, <span style="color:#ae81ff">31522</span> cylinders, total <span style="color:#ae81ff">15130624</span> sectors
</span></span><span style="display:flex;"><span>Units <span style="color:#f92672">=</span> sectors of <span style="color:#ae81ff">1</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Disk identifier: 0x00000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Device Boot      Start         End      Blocks   Id  System
</span></span><span style="display:flex;"><span>/dev/sdb1            <span style="color:#ae81ff">2048</span>    <span style="color:#ae81ff">15130623</span>     <span style="color:#ae81ff">7564288</span>   <span style="color:#ae81ff">83</span>  Linux
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: t
</span></span><span style="display:flex;"><span>Selected partition <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Hex code <span style="color:#f92672">(</span>type L to list codes<span style="color:#f92672">)</span>: c
</span></span><span style="display:flex;"><span>Changed system type of partition <span style="color:#ae81ff">1</span> to c <span style="color:#f92672">(</span>W95 FAT32 <span style="color:#f92672">(</span>LBA<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: a
</span></span><span style="display:flex;"><span>Partition number <span style="color:#f92672">(</span>1-4<span style="color:#f92672">)</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disk /dev/sdb: <span style="color:#ae81ff">7746</span> MB, <span style="color:#ae81ff">7746879488</span> bytes
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">24</span> heads, <span style="color:#ae81ff">20</span> sectors/track, <span style="color:#ae81ff">31522</span> cylinders, total <span style="color:#ae81ff">15130624</span> sectors
</span></span><span style="display:flex;"><span>Units <span style="color:#f92672">=</span> sectors of <span style="color:#ae81ff">1</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Disk identifier: 0x00000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Device Boot      Start         End      Blocks   Id  System
</span></span><span style="display:flex;"><span>/dev/sdb1   *        <span style="color:#ae81ff">2048</span>    <span style="color:#ae81ff">15130623</span>     <span style="color:#ae81ff">7564288</span>    c  W95 FAT32 <span style="color:#f92672">(</span>LBA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#f92672">(</span>m <span style="color:#66d9ef">for</span> help<span style="color:#f92672">)</span>: w
</span></span><span style="display:flex;"><span>The partition table has been altered!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Calling ioctl<span style="color:#f92672">()</span> to re-read partition table.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WARNING: If you have created or modified any DOS 6.x
</span></span><span style="display:flex;"><span>partitions, please see the fdisk manual page <span style="color:#66d9ef">for</span> additional
</span></span><span style="display:flex;"><span>information.
</span></span><span style="display:flex;"><span>Syncing disks.
</span></span></code></pre></div><p>å»ºç«‹å¥½æ–°çš„åˆ†åŒºä¹‹åéœ€è¦å‘½åå¹¶æ ¼å¼åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># sudo mkfs.vfat -F 32 -n boot /dev/sdb1</span>
</span></span></code></pre></div><p>æ ¼å¼åŒ–ä¹‹åæŒ‚è½½ç£ç›˜å¹¶æŠŠ <code>MLO</code> æ–‡ä»¶å’Œ <code>u-boot.img</code> æ–‡ä»¶æ‹·è´è¿›å»ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># sudo mount /dev/sdb1 /media/jg/boot </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sudo cp MLO /media/jg/boot/MLO</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ls /media/jg/boot             </span>
</span></span><span style="display:flex;"><span>MLO
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sudo cp u-boot.img /media/jg/boot/u-boot.img</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ls /media/jg/boot </span>
</span></span><span style="display:flex;"><span>MLO  u-boot.img
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sync </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sudo umount /media/jg/boot </span>
</span></span></code></pre></div><p>æ¥ç€æŠŠ SD å¡æ’å…¥ Beaglebone Black å¹¶ä¸”æŒ‰ç€ S2 æŒ‰é’®ä¸Šç”µï¼Œä»ä¸²å£æ‰“å°å‡ºçš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ° U-Boot å·²ç»å¯ä»¥æ­£å¸¸å¯åŠ¨äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>U-Boot SPL 2016.03-rc2-00084-g595af9d (Feb 29 2016 - 22:21:20)
</span></span><span style="display:flex;"><span>Trying to boot from MMC
</span></span><span style="display:flex;"><span>Card doesn&#39;t support part_switch
</span></span><span style="display:flex;"><span>MMC partition switch failed
</span></span><span style="display:flex;"><span>*** Warning - MMC partition switch failed, using default environment
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>reading u-boot.img
</span></span><span style="display:flex;"><span>reading u-boot.img
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>U-Boot 2016.03-rc2-00084-g595af9d (Feb 29 2016 - 22:21:20 +0800)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>       Watchdog enabled
</span></span><span style="display:flex;"><span>I2C:   ready
</span></span><span style="display:flex;"><span>DRAM:  512 MiB
</span></span><span style="display:flex;"><span>MMC:   OMAP SD/MMC: 0, OMAP SD/MMC: 1
</span></span><span style="display:flex;"><span>*** Warning - bad CRC, using default environment
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Net:   &lt;ethaddr&gt; not set. Validating first E-fuse MAC
</span></span><span style="display:flex;"><span>cpsw, usb_ether
</span></span><span style="display:flex;"><span>Press SPACE to abort autoboot in 2 seconds
</span></span><span style="display:flex;"><span>switch to partitions #0, OK
</span></span><span style="display:flex;"><span>mmc0 is current device
</span></span><span style="display:flex;"><span>Scanning mmc 0:1...
</span></span><span style="display:flex;"><span>switch to partitions #0, OK
</span></span><span style="display:flex;"><span>mmc0 is current device
</span></span><span style="display:flex;"><span>SD/MMC found on device 0
</span></span><span style="display:flex;"><span>reading boot.scr
</span></span><span style="display:flex;"><span>** Unable to read file boot.scr **
</span></span><span style="display:flex;"><span>reading uEnv.txt
</span></span><span style="display:flex;"><span>** Unable to read file uEnv.txt **
</span></span><span style="display:flex;"><span>** File not found /boot/zImage **
</span></span><span style="display:flex;"><span>switch to partitions #0, OK
</span></span><span style="display:flex;"><span>mmc1(part 0) is current device
</span></span><span style="display:flex;"><span>Scanning mmc 1:1...
</span></span><span style="display:flex;"><span>switch to partitions #0, OK
</span></span><span style="display:flex;"><span>mmc1(part 0) is current device
</span></span><span style="display:flex;"><span>SD/MMC found on device 1
</span></span><span style="display:flex;"><span>reading boot.scr
</span></span><span style="display:flex;"><span>** Unable to read file boot.scr **
</span></span><span style="display:flex;"><span>reading uEnv.txt
</span></span><span style="display:flex;"><span>** Unable to read file uEnv.txt **
</span></span><span style="display:flex;"><span>** File not found /boot/zImage **
</span></span><span style="display:flex;"><span>#<span style="color:#75715e"># Error: &#34;bootcmd_nand0&#34; not defined</span>
</span></span><span style="display:flex;"><span>cpsw Waiting for PHY auto negotiation to complete......... TIMEOUT !
</span></span><span style="display:flex;"><span>BOOTP broadcast 1
</span></span><span style="display:flex;"><span>BOOTP broadcast 2
</span></span><span style="display:flex;"><span>BOOTP broadcast 3
</span></span><span style="display:flex;"><span>BOOTP broadcast 4
</span></span></code></pre></div><p>å¯åŠ¨ä¹‹åï¼Œå‰é¢ä¸€æ®µæ‰“å°ä¿¡æ¯æ˜¯ MLO ç¨‹åºæ‰“å°å‡ºæ¥çš„ï¼Œè¯»å– U-Boot ä¹‹åå¼€å§‹è¿è¡Œå®Œæ•´çš„ U-Bootï¼Œä¹‹åç¨‹åºæ‰«æå„ä¸ªè®¾å¤‡è¯»å– <code>boot.scr</code> å’Œ <code>uEnv.txt</code> æ–‡ä»¶ï¼Œæ¥ç€å†è¯»å–æ˜¯å¦æœ‰ Linux å†…æ ¸å¯ä»¥è¿è¡Œã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™<a hidden class="anchor" aria-hidden="true" href="#å‚è€ƒèµ„æ–™">#</a></h2>
<ul>
<li><a href="http://blog.csdn.net/zy812248258/article/details/39120799">Beaglebone Blackâ€”â€”åˆ¶ä½œè‡ªå·±çš„SDå¯åŠ¨å¡</a></li>
<li><a href="http://www.twam.info/hardware/beaglebone-black/u-boot-on-beaglebone-black">U-Boot on BeagleBone Black</a></li>
<li><a href="http://processors.wiki.ti.com/index.php/AM335x_U-Boot_User's_Guide#U-Boot">AM335x U-Boot User&rsquo;s Guide</a></li>
<li><a href="http://blog.kfatso.com/articles/2015/08/15/pandaboard-bootload-process/">Pandaboard bootload(uboot) å¯åŠ¨æµç¨‹æ¢ç©¶</a></li>
<li><a href="http://blog.csdn.net/zsy2020314/article/details/9824035">u-bootå¯åŠ¨æµç¨‹</a></li>
</ul>
<hr>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jesseguox.github.io/tinyx/tags/BeagleBone/">BeagleBone</a></li>
      <li><a href="https://jesseguox.github.io/tinyx/tags/U-Boot/">U-Boot</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://jesseguox.github.io/tinyx/post/BeagleBone-Image/">
    <span class="title">Â« Prev Page</span>
    <br>
    <span>è§£æ BeagleBone Black å®˜æ–¹é•œåƒ</span>
  </a>
  <a class="next" href="https://jesseguox.github.io/tinyx/post/BBB-bootmode/">
    <span class="title">Next Page Â»</span>
    <br>
    <span>BeagleBone Black ä»é›¶åˆ°ä¸€ (1 å¯åŠ¨æµç¨‹)</span>
  </a>
</nav>

  </footer><div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: '',
    owner: '',
    admin: [''],
    id: location.pathname, 
    distractionFreeMode: false 
  });
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://jesseguox.github.io/tinyx/">TinyX</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
