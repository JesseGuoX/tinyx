<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>è§£æ BeagleBone Black å®˜æ–¹é•œåƒ | TinyX</title>
<meta name="keywords" content="BeagleBone">
<meta name="description" content="BeagleBone å®˜æ–¹é•œåƒï¼š BeagleBoard.org Latest Firmware Images
ä¸‹è½½æ¨èçš„é•œåƒ: bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz
.xz æ–‡ä»¶è§£å‹ï¼š
xz -d bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz å¾—åˆ° .img æ–‡ä»¶ã€‚
æŒ‚è½½é•œåƒ åœ¨ Linux ä¸‹æŒ‚è½½ .img æ–‡ä»¶ï¼Œ
å¯è§ç›´æ¥æŒ‚è½½çš„è¯ä¼šå‡ºç°ï¼šmount: you must specify the filesystem typeã€‚ é¦–å…ˆï¼Œè¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œè¿™æƒ…å†µæ˜¯ç”±äº img æ–‡ä»¶çš„å¼€å¤´åŒ…å«äº† MBRï¼Œä»¥è‡´äºç³»ç»Ÿæ— æ³•è¯†åˆ«ã€‚img æ–‡ä»¶ç›¸å½“äºä¸€ä¸ªåŒ…å«æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦æŒ‚è½½å®ƒçš„æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ MBRã€‚
ç»•è¿‡ MBR æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ–¹æ³•ã€‚
ç¬¬ä¸€ç§ï¼š é¦–å…ˆä½¿ç”¨ fdisk æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ï¼š
çœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºä»ç¬¬ 2048 ä¸ªæ‰‡åŒºå¼€å§‹ï¼Œ Units = sectors of 1 * 512 = 512 bytesï¼ŒUnit ï¼ 2048 ï¼Š 512 ï¼ 1048576ï¼Œæ‰€ä»¥æˆ‘ä»¬åç§» 1028576 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬ä¸€ä¸ªåˆ†åŒºï¼› ç¬¬äºŒä¸ªåˆ†åŒºä»ç¬¬ 198656 ä¸ªæ‰‡åŒºå¼€å§‹ï¼ŒUnit = 198656 * 512 = 101711872ï¼Œåç§» 101711872 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬äºŒä¸ªåˆ†åŒºï¼›">
<meta name="author" content="X">
<link rel="canonical" href="https://jesseguox.github.io/tinyx/post/BeagleBone-Image/">
<link crossorigin="anonymous" href="/tinyx/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css" integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/tinyx/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js" integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="è§£æ BeagleBone Black å®˜æ–¹é•œåƒ" />
<meta property="og:description" content="BeagleBone å®˜æ–¹é•œåƒï¼š BeagleBoard.org Latest Firmware Images
ä¸‹è½½æ¨èçš„é•œåƒ: bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz
.xz æ–‡ä»¶è§£å‹ï¼š
xz -d bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz å¾—åˆ° .img æ–‡ä»¶ã€‚
æŒ‚è½½é•œåƒ åœ¨ Linux ä¸‹æŒ‚è½½ .img æ–‡ä»¶ï¼Œ
å¯è§ç›´æ¥æŒ‚è½½çš„è¯ä¼šå‡ºç°ï¼šmount: you must specify the filesystem typeã€‚ é¦–å…ˆï¼Œè¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œè¿™æƒ…å†µæ˜¯ç”±äº img æ–‡ä»¶çš„å¼€å¤´åŒ…å«äº† MBRï¼Œä»¥è‡´äºç³»ç»Ÿæ— æ³•è¯†åˆ«ã€‚img æ–‡ä»¶ç›¸å½“äºä¸€ä¸ªåŒ…å«æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦æŒ‚è½½å®ƒçš„æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ MBRã€‚
ç»•è¿‡ MBR æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ–¹æ³•ã€‚
ç¬¬ä¸€ç§ï¼š é¦–å…ˆä½¿ç”¨ fdisk æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ï¼š
çœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºä»ç¬¬ 2048 ä¸ªæ‰‡åŒºå¼€å§‹ï¼Œ Units = sectors of 1 * 512 = 512 bytesï¼ŒUnit ï¼ 2048 ï¼Š 512 ï¼ 1048576ï¼Œæ‰€ä»¥æˆ‘ä»¬åç§» 1028576 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬ä¸€ä¸ªåˆ†åŒºï¼› ç¬¬äºŒä¸ªåˆ†åŒºä»ç¬¬ 198656 ä¸ªæ‰‡åŒºå¼€å§‹ï¼ŒUnit = 198656 * 512 = 101711872ï¼Œåç§» 101711872 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬äºŒä¸ªåˆ†åŒºï¼›" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jesseguox.github.io/tinyx/post/BeagleBone-Image/" /><meta property="og:image" content="https://jesseguox.github.io/tinyx/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2016-03-26T19:37:17&#43;00:00" />
<meta property="article:modified_time" content="2016-03-26T19:37:17&#43;00:00" /><meta property="og:site_name" content="ExampleSite" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jesseguox.github.io/tinyx/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/>

<meta name="twitter:title" content="è§£æ BeagleBone Black å®˜æ–¹é•œåƒ"/>
<meta name="twitter:description" content="BeagleBone å®˜æ–¹é•œåƒï¼š BeagleBoard.org Latest Firmware Images
ä¸‹è½½æ¨èçš„é•œåƒ: bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz
.xz æ–‡ä»¶è§£å‹ï¼š
xz -d bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz å¾—åˆ° .img æ–‡ä»¶ã€‚
æŒ‚è½½é•œåƒ åœ¨ Linux ä¸‹æŒ‚è½½ .img æ–‡ä»¶ï¼Œ
å¯è§ç›´æ¥æŒ‚è½½çš„è¯ä¼šå‡ºç°ï¼šmount: you must specify the filesystem typeã€‚ é¦–å…ˆï¼Œè¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œè¿™æƒ…å†µæ˜¯ç”±äº img æ–‡ä»¶çš„å¼€å¤´åŒ…å«äº† MBRï¼Œä»¥è‡´äºç³»ç»Ÿæ— æ³•è¯†åˆ«ã€‚img æ–‡ä»¶ç›¸å½“äºä¸€ä¸ªåŒ…å«æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦æŒ‚è½½å®ƒçš„æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ MBRã€‚
ç»•è¿‡ MBR æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ–¹æ³•ã€‚
ç¬¬ä¸€ç§ï¼š é¦–å…ˆä½¿ç”¨ fdisk æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ï¼š
çœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºä»ç¬¬ 2048 ä¸ªæ‰‡åŒºå¼€å§‹ï¼Œ Units = sectors of 1 * 512 = 512 bytesï¼ŒUnit ï¼ 2048 ï¼Š 512 ï¼ 1048576ï¼Œæ‰€ä»¥æˆ‘ä»¬åç§» 1028576 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬ä¸€ä¸ªåˆ†åŒºï¼› ç¬¬äºŒä¸ªåˆ†åŒºä»ç¬¬ 198656 ä¸ªæ‰‡åŒºå¼€å§‹ï¼ŒUnit = 198656 * 512 = 101711872ï¼Œåç§» 101711872 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬äºŒä¸ªåˆ†åŒºï¼›"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://jesseguox.github.io/tinyx/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "è§£æ BeagleBone Black å®˜æ–¹é•œåƒ",
      "item": "https://jesseguox.github.io/tinyx/post/BeagleBone-Image/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "è§£æ BeagleBone Black å®˜æ–¹é•œåƒ",
  "name": "è§£æ BeagleBone Black å®˜æ–¹é•œåƒ",
  "description": "BeagleBone å®˜æ–¹é•œåƒï¼š BeagleBoard.org Latest Firmware Images\nä¸‹è½½æ¨èçš„é•œåƒ: bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz\n.xz æ–‡ä»¶è§£å‹ï¼š\nxz -d bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz å¾—åˆ° .img æ–‡ä»¶ã€‚\næŒ‚è½½é•œåƒ åœ¨ Linux ä¸‹æŒ‚è½½ .img æ–‡ä»¶ï¼Œ\nå¯è§ç›´æ¥æŒ‚è½½çš„è¯ä¼šå‡ºç°ï¼šmount: you must specify the filesystem typeã€‚ é¦–å…ˆï¼Œè¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œè¿™æƒ…å†µæ˜¯ç”±äº img æ–‡ä»¶çš„å¼€å¤´åŒ…å«äº† MBRï¼Œä»¥è‡´äºç³»ç»Ÿæ— æ³•è¯†åˆ«ã€‚img æ–‡ä»¶ç›¸å½“äºä¸€ä¸ªåŒ…å«æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦æŒ‚è½½å®ƒçš„æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ MBRã€‚\nç»•è¿‡ MBR æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ–¹æ³•ã€‚\nç¬¬ä¸€ç§ï¼š é¦–å…ˆä½¿ç”¨ fdisk æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ï¼š\nçœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºä»ç¬¬ 2048 ä¸ªæ‰‡åŒºå¼€å§‹ï¼Œ Units = sectors of 1 * 512 = 512 bytesï¼ŒUnit ï¼ 2048 ï¼Š 512 ï¼ 1048576ï¼Œæ‰€ä»¥æˆ‘ä»¬åç§» 1028576 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬ä¸€ä¸ªåˆ†åŒºï¼› ç¬¬äºŒä¸ªåˆ†åŒºä»ç¬¬ 198656 ä¸ªæ‰‡åŒºå¼€å§‹ï¼ŒUnit = 198656 * 512 = 101711872ï¼Œåç§» 101711872 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬äºŒä¸ªåˆ†åŒºï¼›",
  "keywords": [
    "BeagleBone"
  ],
  "articleBody": "BeagleBone å®˜æ–¹é•œåƒï¼š BeagleBoard.org Latest Firmware Images\nä¸‹è½½æ¨èçš„é•œåƒ: bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz\n.xz æ–‡ä»¶è§£å‹ï¼š\nxz -d bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz å¾—åˆ° .img æ–‡ä»¶ã€‚\næŒ‚è½½é•œåƒ åœ¨ Linux ä¸‹æŒ‚è½½ .img æ–‡ä»¶ï¼Œ\nå¯è§ç›´æ¥æŒ‚è½½çš„è¯ä¼šå‡ºç°ï¼šmount: you must specify the filesystem typeã€‚ é¦–å…ˆï¼Œè¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œè¿™æƒ…å†µæ˜¯ç”±äº img æ–‡ä»¶çš„å¼€å¤´åŒ…å«äº† MBRï¼Œä»¥è‡´äºç³»ç»Ÿæ— æ³•è¯†åˆ«ã€‚img æ–‡ä»¶ç›¸å½“äºä¸€ä¸ªåŒ…å«æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦æŒ‚è½½å®ƒçš„æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ MBRã€‚\nç»•è¿‡ MBR æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ–¹æ³•ã€‚\nç¬¬ä¸€ç§ï¼š é¦–å…ˆä½¿ç”¨ fdisk æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ï¼š\nçœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºä»ç¬¬ 2048 ä¸ªæ‰‡åŒºå¼€å§‹ï¼Œ Units = sectors of 1 * 512 = 512 bytesï¼ŒUnit ï¼ 2048 ï¼Š 512 ï¼ 1048576ï¼Œæ‰€ä»¥æˆ‘ä»¬åç§» 1028576 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬ä¸€ä¸ªåˆ†åŒºï¼› ç¬¬äºŒä¸ªåˆ†åŒºä»ç¬¬ 198656 ä¸ªæ‰‡åŒºå¼€å§‹ï¼ŒUnit = 198656 * 512 = 101711872ï¼Œåç§» 101711872 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬äºŒä¸ªåˆ†åŒºï¼›\nç¬¬äºŒç§: å®‰è£… kpartxï¼Œå…ˆæŠŠé•œåƒæŒ‚è½½åˆ° loop è®¾å¤‡ä¸Šï¼Œç„¶åä½¿ç”¨ kpartx åˆ›å»ºåˆ†åŒºè¡¨æ˜ å°„ï¼Œå¹¶æŒ‚è½½ç›¸åº”çš„æ˜ å°„ã€‚\né•œåƒåˆ†æ ä» AM335x çš„å¯åŠ¨æµç¨‹å¯çŸ¥ï¼Œå¦‚æœéœ€è¦å¯åŠ¨ U-Bootï¼ŒFAT å¯åŠ¨æ¨¡å¼ä¸‹å¿…é¡»å¾—æœ‰ä¸€ä¸ªåœ¨ FAT æ ¼å¼çš„æ´»è·ƒä¸»åˆ†åŒºä¸­åä¸º MLO çš„æ–‡ä»¶ä¾› ROM Code è¿è¡Œã€‚ä½†æ˜¯æˆ‘ä»¬åˆ†æé•œåƒé‡Œé¢ç¬¬ä¸€ä¸ª FAT åˆ†åŒºå¹¶æ²¡æœ‰å‘ç° MLO æ–‡ä»¶ã€‚\n æ—©æœŸçš„ BeagleBone Black æ˜ åƒä¼šæŠŠ MLO å’Œ u-boot.img æ”¾åœ¨æ´»è·ƒä¸»åˆ†åŒºï¼ˆactive primary partitionï¼‰çš„ FAT æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•é‡Œã€‚SD çš„æ˜ åƒä¼šåŒ…å«ä¸¤ä¸ªåˆ†åŒºï¼Œä¸€ä¸ª FAT32 åˆ†åŒºå’Œä¸€ä¸ª Linux ext3/4 åˆ†åŒºã€‚å…¨åŠŸèƒ½çš„ç¬¬äºŒé˜¶æ®µ U-Boot ä¼šåŒ…å«ç¡¬ç¼–ç çš„ç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥é è¿™äº›ç¯å¢ƒå˜é‡æä¾›çš„é…ç½®è¿›ä¸€æ­¥åŠ è½½ uEnv.txtï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨ç¡¬ç¼–ç çš„ç¯å¢ƒå˜é‡å’Œ uEnv.txt æ˜¯å› ä¸ºé‡‡ç”¨è¿™ç§é…ç½®æ–¹å¼çš„ U-Boot ä¸èƒ½ç”¨ saveenv ä¿å­˜ç¯å¢ƒå˜é‡ã€‚\n  æœ€è¿‘ï¼ŒBeagleBone Black é‡‡ç”¨æ‰€è°“ RAWæ¨¡å¼ çš„ U-Boot é…ç½®æ–¹å¼ã€‚åœ¨ RAW æ¨¡å¼ä¸‹ï¼Œå†…ç½® ROM ä»£ç ä¼šä¾æ¬¡ä» sector #0 (offset 0x00000)ã€sector #256 (0x20000)ã€sector #512 (0x40000)å’Œsector #768 (0x60000) è¿™å‡ ä¸ªä½ç½®æ¥æœç´¢ TOC structure/Configuration Headerï¼ˆè¿™ä¸ªæ•°æ®ç»“æ„å¯ä»¥åœ¨TIçš„AM335x Technical Reference Manualä¸­æŸ¥åˆ°ï¼‰ã€‚ å¦‚æœä½ è¿˜æƒ³å°†MMCä½œä¸ºä¸€ä¸ªç£ç›˜ï¼Œé‚£ä¹ˆ MMC ä¸Šå°±å¿…é¡»æœ‰ä¸€ä¸ª MBRã€‚åœ¨è¿™ç§é…ç½®ä¸‹ï¼Œä½ å°±ä¸èƒ½æŠŠ U-Boot SPL/MLOæ”¾åœ¨sector #0 äº†ï¼ˆå‚è§Wikipediaé‡Œçš„MBRç»“æ„ï¼‰ã€‚ç”±äºå‰é¢æåˆ° ROM ä»£ç ä¼šé¡ºåºæœç´¢å¯ç”¨çš„MLOï¼Œå› æ­¤æŠŠ U-Boot SPL/MLO æ”¾åˆ°0x20000 (sector #256)å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n  éšåï¼ŒU-boot SPL å¯ä»¥ä» 0x60000 è¿›ä¸€æ­¥åŠ è½½å®Œæ•´åŠŸèƒ½çš„ U-Bootã€‚ä»å—å­˜å‚¨è®¾å¤‡è¿è¡Œ U-Boot çš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å¯ä»¥ä¿å­˜ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå°±ä¸å†éœ€è¦åŠ è½½ uEnv.txtã€‚\n æ‰€ä»¥ç›®å‰ Beaglebone Black å®˜æ–¹é•œåƒæŠŠ MLO å’Œ U-Boot æ•°æ®å†™å…¥åœ¨ç¬¬ä¸€ä¸ªåˆ†åŒºä¹‹å‰çš„æ‰‡åŒºå†…ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ä» sector 2048 å¼€å§‹ï¼Œæ¯ä¸ª sector ä¸º 512å­—èŠ‚ï¼Œæ‰€ä»¥è¶³è¶³æœ‰ 1MB çš„å­˜å‚¨ç©ºé—´ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ å½“æŠŠ MLO å’Œ U-Boot ç”¨ RAW Mode å†™å…¥çš„æ—¶å€™ï¼Œå¤„ç†å™¨ SPL é˜¶æ®µä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯ RAW Mode è¿˜æ˜¯ FTA Mode å¯åŠ¨ã€‚\nMBR ä¸»å¼•å¯¼è®°å½•ï¼ˆMaster Boot Recordï¼Œç¼©å†™ï¼šMBRï¼‰ï¼Œåˆå«åšä¸»å¼•å¯¼æ‰‡åŒºï¼Œæ˜¯è®¡ç®—æœºå¼€æœºåè®¿é—®ç¡¬ç›˜æ—¶æ‰€å¿…é¡»è¦è¯»å–çš„é¦–ä¸ªæ‰‡åŒºã€‚ä¸»å¼•å¯¼æ‰‡åŒºè®°å½•ç€ç¡¬ç›˜æœ¬èº«çš„ç›¸å…³ä¿¡æ¯ä»¥åŠç¡¬ç›˜å„ä¸ªåˆ†åŒºçš„å¤§å°åŠä½ç½®ä¿¡æ¯ï¼Œæ˜¯æ•°æ®ä¿¡æ¯çš„é‡è¦å…¥å£ã€‚ æ ‡å‡† MBR ç»“æ„å¦‚ä¸‹å›¾ï¼š\nä½¿ç”¨ dd å‘½ä»¤æå–å‡ºé•œåƒå‰ 2048 æ‰‡åŒºï¼ˆ2048*512 å­—èŠ‚ï¼‰çš„æ•°æ®ï¼ŒæŸ¥çœ‹å‰ 512 å­—èŠ‚æ˜¯å¦å­˜åœ¨ MBRï¼š\nå¯ä»¥çœ‹åˆ°åœ°å€ 0x01BEâ€“0x01FD çš„ç¡®å­˜åœ¨åˆ†åŒºè¡¨ï¼Œä¸”æœ‰ MBR æœ‰æ•ˆæ ‡å¿— 0x55AAï¼Œä½†æ˜¯æˆ‘ä»¬æå–å‡ºæ¥ä¸º 0xAA55 ï¼Œè¿™é‡Œè‚¯å®šæ˜¯å¤§å°ç«¯ä¸ä¸€è‡´é€ æˆçš„ã€‚\næ ¹æ®ç¡¬ç›˜åˆ†åŒºè¡¨ç»“æ„ä¿¡æ¯åˆ†æå‡ºæ¥çš„åˆ†åŒºæƒ…å†µå’Œ fdisk å·¥å…·æŸ¥çœ‹çš„åˆ†åŒºæƒ…å†µä¸€è‡´ã€‚\nå¯åŠ¨ä»£ç  å‰é¢é•œåƒåˆ†æå‡ºï¼ŒMBR å ç”¨äº†ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼Œæ‰€ä»¥å¯åŠ¨ä»£ç  MLO å’Œ U-Boot è‚¯å®šå­˜å‚¨åœ¨åœ°å€ 0x20000ã€0x40000æˆ–0x60000å¤„ã€‚ RAW æ¨¡å¼ä¸‹å­˜å‚¨ä¹Ÿæœ‰ä¸€å®šæ ¼å¼ï¼Œå¦‚æœæ˜¯é€šç”¨è®¾å¤‡ï¼Œåˆ™ TOC structure/Configuration Header åˆ™å¿…é¡»å­˜å‚¨åœ¨ç¬¬ä¸€ä¸ªæ‰‡åŒºä¸­ï¼Œå¹¶ä¸”ç´§è·Ÿç€æ˜¯ GP Headerã€‚\n The raw mode is detected by reading sectors #0, #256, #512, #768. The content of these sectors is then verified for presence of a TOC structure as described in Section 26.1.9. In the case of a GP Device, a Configuration Header (CH) must be located in the first sector followed by a GP header. The CH might be void (only containing a CHSETTINGS item for which the Valid field is zero).\n è¿˜æ˜¯åˆ†æåˆšåˆšæå–å‡ºæ¥çš„æ•°æ®ï¼Œ ä»åœ°å€ 0x20000 å¼€å§‹çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼š\nçœ‹æ•°æ®çš„ç¡®åŒ…å«äº† RAW Mode çš„é…ç½®å¤´ã€‚ é‚£ä¹ˆè¿™ä¸ªæ‰‡åŒºä¹‹åç´§è·Ÿç€å°±æ˜¯åŒ…å« GP Header çš„é•œåƒæ–‡ä»¶æ•°æ®äº†ï¼Œä»åœ°å€ 0x0000 å¼€å§‹ä¸ºæ•°æ®å¤§å°ï¼Œåœ°å€ 0x0004 å¼€å§‹ä¸ºè¦æ‹·è´è‡³çš„ç›®æ ‡åœ°å€ï¼Œ0x0008 åœ°å€å¼€å§‹æ¥ä¸‹æ¥å°±æ˜¯é•œåƒæ•°æ®ï¼Œç»“æ„å¦‚ä¸‹ï¼š\nè¿˜æ˜¯ç”¨ hexdump åˆ†æï¼š\nå¤§å°ç«¯è½¬æ¢ä¸‹å¾—åˆ°ï¼šé•œåƒæ•°æ®å¤§å°ä¸º 0x0000fe4c ï¼ 65100 bytesï¼Œç›®æ ‡åœ°å€ä¸º 0x402f0400ï¼Œæ­¤åœ°å€ä¸º AM335x çš„å†…éƒ¨ SRAM çš„åœ°å€ï¼Œæ‰€ä»¥ RAM Code ä¼šæŠŠ MLO æ‹·è´åˆ°å†…éƒ¨ SRAM è¿è¡Œã€‚\nMLO å¯åŠ¨ä¹‹åä¼šåœ¨åœ°å€ 0x60000 ä¹Ÿå°±æ˜¯ç¬¬ 0x300 æ‰‡åŒºå¼€å§‹åŠ è½½ U-Bootã€‚ï¼ˆMLO ä¼šåˆ†åˆ«åœ¨ RAW æ¨¡å¼ FAT ç­‰æ¨¡å¼ä¸‹æŸ¥æ‰¾å¯ç”¨çš„ u-boot.imgï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨ hexdump å·¥å…·ä¹Ÿçš„ç¡®èƒ½ä»åœ°å€ 0x60000 å¼€å§‹å‘ç°æœ‰æ•ˆæ•°æ®ã€‚\nU-Boot å¯åŠ¨åä¼šæ ¹æ® U-Boot é…ç½®çš„æ–‡ä»¶ä½ç½®ä¿¡æ¯ï¼ˆDFU_ALT_INFO_MMCï¼‰æŸ¥æ‰¾å¯ç”¨çš„ uEnv.txt æ–‡ä»¶ï¼Œå¹¶è¿è¡Œç›¸å…³çš„å‘½ä»¤ï¼š\n##These are needed to be compliant with Angstrom's 2013.06.20 u-boot. loadaddr=0x82000000 fdtaddr=0x88000000 rdaddr=0x88080000 initrd_high=0xffffffff fdt_high=0xffffffff ##These are needed to be compliant with Debian 2014-05-14 u-boot. loadximage=echo debug: [/boot/vmlinuz-${uname_r}] ... ; load mmc 0:2 ${loadaddr} /boot/vmlinuz-${uname_r} loadxfdt=echo debug: [/boot/dtbs/${uname_r}/${fdtfile}] ... ;load mmc 0:2 ${fdtaddr} /boot/dtbs/${uname_r}/${fdtfile} loadxrd=echo debug: [/boot/initrd.img-${uname_r}] ... ; load mmc 0:2 ${rdaddr} /boot/initrd.img-${uname_r}; setenv rdsize ${filesize} loaduEnvtxt=load mmc 0:2 ${loadaddr} /boot/uEnv.txt ; env import -t ${loadaddr} ${filesize}; check_dtb=if test -n ${dtb}; then setenv fdtfile ${dtb};fi; loadall=run loaduEnvtxt; run check_dtb; run loadximage; run loadxrd; run loadxfdt; mmcargs=setenv bootargs console=tty0 console=${console} ${optargs} ${cape_disable} ${cape_enable} root=/dev/mmcblk0p2 rootfstype=${mmcrootfstype} ${cmdline} uenvcmd=run loadall; run mmcargs; echo debug: [${bootargs}] ... ; echo debug: [bootz ${loadaddr} ${rdaddr}:${rdsize} ${fdtaddr}] ... ; bootz ${loadaddr} ${rdaddr}:${rdsize} ${fdtaddr}; å®˜æ–¹é•œåƒé‡Œé¢çš„ uEnv.txt ä¸»è¦åŒ…å«ä»å“ªä¸ªä½ç½®åŠ è½½å†…æ ¸é•œåƒçš„å‘½ä»¤ï¼ŒU-Boot åŠ è½½æ–‡ä»¶ååä¼šè¿è¡Œ uenvcmd å‘½ä»¤ï¼Œè¿™æ ·å°±èƒ½å¯åŠ¨ Linux å†…æ ¸äº†ã€‚\nå¦‚ä½•çƒ§å†™ å°†Bootloaderæ˜ åƒç”¨ RAW æ¨¡å¼ä¿å­˜åˆ°eMMC/SDå¡ä¸­ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†æ–‡ä»¶å†™å…¥åˆ°SDå¡æˆ–è€…eMMCçš„èµ·å§‹ä½ç½®ï¼š\n# è¿™é‡Œçš„conv=ontruncåŠ ä¸åŠ éƒ½è¡Œï¼Œå› ä¸ºå¯¹äºå—è®¾å¤‡æ¥è¯´ï¼Œnotruncæ²¡æœ‰ä½œç”¨ # æ¯ä¸ªblockä¸º512å­—èŠ‚ï¼Œè·³è¿‡256ä¸ªblockï¼Œå†™å…¥256ä¸ªblock dd if=MLO of=/dev/sdb bs=512 seek=256 count=256 conv=notrunc dd if=u-boot.img of=/dev/sdb bs=512 seek=768 count=1024 conv=notrunc å¦‚æœä½ å†™å…¥çš„æ˜¯ä¸€ä¸ªå¯æ’æ‹”SDå¡ï¼Œé‚£ä¹ˆç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç¡®ä¿å†…å®¹éƒ½ç¡®å®å†™å…¥åˆ°äº†å¡ä¸­ï¼š\nsudo blockdev --flushbufs /dev/sdb å‚è€ƒ  ä¸»å¼•å¯¼æ‰‡åŒºMBRçš„è§£æ ; Beaglebone Black Notes; Linuxæ“ä½œç³»ç»Ÿ è¯»å–MBRä¿¡æ¯   ",
  "wordCount" : "543",
  "inLanguage": "en",
  "datePublished": "2016-03-26T19:37:17Z",
  "dateModified": "2016-03-26T19:37:17Z",
  "author":{
    "@type": "Person",
    "name": "X"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jesseguox.github.io/tinyx/post/BeagleBone-Image/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "TinyX",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jesseguox.github.io/tinyx/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jesseguox.github.io/tinyx/" accesskey="h" title="TinyX ğŸ‘¾ (Alt + H)">TinyX ğŸ‘¾</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jesseguox.github.io/tinyx/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://jesseguox.github.io/tinyx/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://jesseguox.github.io/tinyx/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://jesseguox.github.io/tinyx/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://jesseguox.github.io/tinyx/">Home</a>&nbsp;Â»&nbsp;<a href="https://jesseguox.github.io/tinyx/post/">Posts</a></div>
    <h1 class="post-title">
      è§£æ BeagleBone Black å®˜æ–¹é•œåƒ
    </h1>
    <div class="post-meta"><span title='2016-03-26 19:37:17 +0000 UTC'>March 26, 2016</span>&nbsp;Â·&nbsp;X

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%8c%82%e8%bd%bd%e9%95%9c%e5%83%8f" aria-label="æŒ‚è½½é•œåƒ">æŒ‚è½½é•œåƒ</a><ul>
                        
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e7%a7%8d" aria-label="ç¬¬ä¸€ç§ï¼š">ç¬¬ä¸€ç§ï¼š</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e7%a7%8d" aria-label="ç¬¬äºŒç§:">ç¬¬äºŒç§:</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%95%9c%e5%83%8f%e5%88%86%e6%9e%90" aria-label="é•œåƒåˆ†æ">é•œåƒåˆ†æ</a><ul>
                        
                <li>
                    <a href="#mbr" aria-label="MBR">MBR</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8%e4%bb%a3%e7%a0%81" aria-label="å¯åŠ¨ä»£ç ">å¯åŠ¨ä»£ç </a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e7%83%a7%e5%86%99" aria-label="å¦‚ä½•çƒ§å†™">å¦‚ä½•çƒ§å†™</a></li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83" aria-label="å‚è€ƒ">å‚è€ƒ</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>BeagleBone å®˜æ–¹é•œåƒï¼š
<a href="https://beagleboard.org/latest-images">BeagleBoard.org Latest Firmware Images</a></p>
<p>ä¸‹è½½æ¨èçš„é•œåƒ:
<code>bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz</code></p>
<p><code>.xz</code> æ–‡ä»¶è§£å‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xz -d bone-debian-7.9-lxde-4gb-armhf-2015-11-12-4gb.img.xz
</span></span></code></pre></div><p>å¾—åˆ° <code>.img</code> æ–‡ä»¶ã€‚</p>
<!-- raw HTML omitted -->
<h2 id="æŒ‚è½½é•œåƒ">æŒ‚è½½é•œåƒ<a hidden class="anchor" aria-hidden="true" href="#æŒ‚è½½é•œåƒ">#</a></h2>
<p>åœ¨ Linux ä¸‹æŒ‚è½½ <code>.img</code> æ–‡ä»¶ï¼Œ</p>
<p><img loading="lazy" src="mbr.png" alt="P1"  />
</p>
<p>å¯è§ç›´æ¥æŒ‚è½½çš„è¯ä¼šå‡ºç°ï¼š<code>mount: you must specify the filesystem type</code>ã€‚
é¦–å…ˆï¼Œè¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œè¿™æƒ…å†µæ˜¯ç”±äº <code>img</code> æ–‡ä»¶çš„å¼€å¤´åŒ…å«äº† <code>MBR</code>ï¼Œä»¥è‡´äºç³»ç»Ÿæ— æ³•è¯†åˆ«ã€‚<code>img</code> æ–‡ä»¶ç›¸å½“äºä¸€ä¸ªåŒ…å«æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦æŒ‚è½½å®ƒçš„æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ <code>MBR</code>ã€‚</p>
<p>ç»•è¿‡ <code>MBR</code> æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ–¹æ³•ã€‚</p>
<h3 id="ç¬¬ä¸€ç§">ç¬¬ä¸€ç§ï¼š<a hidden class="anchor" aria-hidden="true" href="#ç¬¬ä¸€ç§">#</a></h3>
<p>é¦–å…ˆä½¿ç”¨ fdisk æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ï¼š</p>
<p><img loading="lazy" src="fdisk.png" alt="P2"  />
</p>
<p>çœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºä»ç¬¬ 2048 ä¸ªæ‰‡åŒºå¼€å§‹ï¼Œ <code>Units = sectors of 1 * 512 = 512 bytes</code>ï¼ŒUnit ï¼ 2048 ï¼Š 512 ï¼ 1048576ï¼Œæ‰€ä»¥æˆ‘ä»¬åç§» 1028576 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬ä¸€ä¸ªåˆ†åŒºï¼›
ç¬¬äºŒä¸ªåˆ†åŒºä»ç¬¬ 198656 ä¸ªæ‰‡åŒºå¼€å§‹ï¼ŒUnit = 198656 * 512 = 101711872ï¼Œåç§» 101711872 ä¸ªå­—èŠ‚æŒ‚è½½ç¬¬äºŒä¸ªåˆ†åŒºï¼›</p>
<p><img loading="lazy" src="MountWay1.png" alt="P3"  />
</p>
<h3 id="ç¬¬äºŒç§">ç¬¬äºŒç§:<a hidden class="anchor" aria-hidden="true" href="#ç¬¬äºŒç§">#</a></h3>
<p>å®‰è£… kpartxï¼Œå…ˆæŠŠé•œåƒæŒ‚è½½åˆ° loop è®¾å¤‡ä¸Šï¼Œç„¶åä½¿ç”¨ kpartx åˆ›å»ºåˆ†åŒºè¡¨æ˜ å°„ï¼Œå¹¶æŒ‚è½½ç›¸åº”çš„æ˜ å°„ã€‚</p>
<p><img loading="lazy" src="MountWay2.png" alt="P4"  />
</p>
<h2 id="é•œåƒåˆ†æ">é•œåƒåˆ†æ<a hidden class="anchor" aria-hidden="true" href="#é•œåƒåˆ†æ">#</a></h2>
<p>ä» <a href="http://jexbat.com/2016/BBB-bootmode/">AM335x çš„å¯åŠ¨æµç¨‹</a>å¯çŸ¥ï¼Œå¦‚æœéœ€è¦å¯åŠ¨ U-Bootï¼ŒFAT å¯åŠ¨æ¨¡å¼ä¸‹å¿…é¡»å¾—æœ‰ä¸€ä¸ªåœ¨ FAT æ ¼å¼çš„æ´»è·ƒä¸»åˆ†åŒºä¸­åä¸º MLO çš„æ–‡ä»¶ä¾› ROM Code è¿è¡Œã€‚ä½†æ˜¯æˆ‘ä»¬åˆ†æé•œåƒé‡Œé¢ç¬¬ä¸€ä¸ª FAT åˆ†åŒºå¹¶æ²¡æœ‰å‘ç° MLO æ–‡ä»¶ã€‚</p>
<blockquote>
<p>æ—©æœŸçš„ BeagleBone Black æ˜ åƒä¼šæŠŠ MLO å’Œ u-boot.img æ”¾åœ¨æ´»è·ƒä¸»åˆ†åŒºï¼ˆactive primary partitionï¼‰çš„ FAT æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•é‡Œã€‚SD çš„æ˜ åƒä¼šåŒ…å«ä¸¤ä¸ªåˆ†åŒºï¼Œä¸€ä¸ª FAT32 åˆ†åŒºå’Œä¸€ä¸ª Linux ext3/4 åˆ†åŒºã€‚å…¨åŠŸèƒ½çš„ç¬¬äºŒé˜¶æ®µ U-Boot ä¼šåŒ…å«ç¡¬ç¼–ç çš„ç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥é è¿™äº›ç¯å¢ƒå˜é‡æä¾›çš„é…ç½®è¿›ä¸€æ­¥åŠ è½½ uEnv.txtï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨ç¡¬ç¼–ç çš„ç¯å¢ƒå˜é‡å’Œ uEnv.txt æ˜¯å› ä¸ºé‡‡ç”¨è¿™ç§é…ç½®æ–¹å¼çš„ U-Boot ä¸èƒ½ç”¨ saveenv ä¿å­˜ç¯å¢ƒå˜é‡ã€‚</p>
</blockquote>
<blockquote>
<p>æœ€è¿‘ï¼ŒBeagleBone Black é‡‡ç”¨æ‰€è°“ <code>RAWæ¨¡å¼</code> çš„ U-Boot é…ç½®æ–¹å¼ã€‚åœ¨ RAW æ¨¡å¼ä¸‹ï¼Œå†…ç½® ROM ä»£ç ä¼šä¾æ¬¡ä» sector #0 (offset 0x00000)ã€sector #256 (0x20000)ã€sector #512 (0x40000)å’Œsector #768 (0x60000) è¿™å‡ ä¸ªä½ç½®æ¥æœç´¢ TOC structure/Configuration Headerï¼ˆè¿™ä¸ªæ•°æ®ç»“æ„å¯ä»¥åœ¨TIçš„AM335x Technical Reference Manualä¸­æŸ¥åˆ°ï¼‰ã€‚
å¦‚æœä½ è¿˜æƒ³å°†MMCä½œä¸ºä¸€ä¸ªç£ç›˜ï¼Œé‚£ä¹ˆ MMC ä¸Šå°±å¿…é¡»æœ‰ä¸€ä¸ª MBRã€‚åœ¨è¿™ç§é…ç½®ä¸‹ï¼Œä½ å°±ä¸èƒ½æŠŠ U-Boot SPL/MLOæ”¾åœ¨sector #0 äº†ï¼ˆå‚è§Wikipediaé‡Œçš„MBRç»“æ„ï¼‰ã€‚ç”±äºå‰é¢æåˆ° ROM ä»£ç ä¼šé¡ºåºæœç´¢å¯ç”¨çš„MLOï¼Œå› æ­¤æŠŠ U-Boot SPL/MLO æ”¾åˆ°0x20000 (sector #256)å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
<blockquote>
<p>éšåï¼ŒU-boot SPL å¯ä»¥ä» 0x60000 è¿›ä¸€æ­¥åŠ è½½å®Œæ•´åŠŸèƒ½çš„ U-Bootã€‚ä»å—å­˜å‚¨è®¾å¤‡è¿è¡Œ U-Boot çš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å¯ä»¥ä¿å­˜ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå°±ä¸å†éœ€è¦åŠ è½½ uEnv.txtã€‚</p>
</blockquote>
<p><strong>æ‰€ä»¥ç›®å‰ Beaglebone Black å®˜æ–¹é•œåƒæŠŠ MLO å’Œ U-Boot æ•°æ®å†™å…¥åœ¨ç¬¬ä¸€ä¸ªåˆ†åŒºä¹‹å‰çš„æ‰‡åŒºå†…ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ä» sector 2048 å¼€å§‹ï¼Œæ¯ä¸ª sector ä¸º 512å­—èŠ‚ï¼Œæ‰€ä»¥è¶³è¶³æœ‰ 1MB çš„å­˜å‚¨ç©ºé—´ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚</strong>  å½“æŠŠ MLO å’Œ U-Boot ç”¨ RAW Mode å†™å…¥çš„æ—¶å€™ï¼Œå¤„ç†å™¨ SPL é˜¶æ®µä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯ RAW Mode è¿˜æ˜¯ FTA Mode å¯åŠ¨ã€‚</p>
<h3 id="mbr">MBR<a hidden class="anchor" aria-hidden="true" href="#mbr">#</a></h3>
<p>ä¸»å¼•å¯¼è®°å½•ï¼ˆMaster Boot Recordï¼Œç¼©å†™ï¼šMBRï¼‰ï¼Œåˆå«åšä¸»å¼•å¯¼æ‰‡åŒºï¼Œæ˜¯è®¡ç®—æœºå¼€æœºåè®¿é—®ç¡¬ç›˜æ—¶æ‰€å¿…é¡»è¦è¯»å–çš„é¦–ä¸ªæ‰‡åŒºã€‚ä¸»å¼•å¯¼æ‰‡åŒºè®°å½•ç€ç¡¬ç›˜æœ¬èº«çš„ç›¸å…³ä¿¡æ¯ä»¥åŠç¡¬ç›˜å„ä¸ªåˆ†åŒºçš„å¤§å°åŠä½ç½®ä¿¡æ¯ï¼Œæ˜¯æ•°æ®ä¿¡æ¯çš„é‡è¦å…¥å£ã€‚
æ ‡å‡† MBR ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<p><img loading="lazy" src="mbr-struct.png" alt="P5"  />
</p>
<p>ä½¿ç”¨ <code>dd</code> å‘½ä»¤æå–å‡ºé•œåƒå‰ 2048 æ‰‡åŒºï¼ˆ2048*512 å­—èŠ‚ï¼‰çš„æ•°æ®ï¼ŒæŸ¥çœ‹å‰ 512 å­—èŠ‚æ˜¯å¦å­˜åœ¨ MBRï¼š</p>
<p><img loading="lazy" src="mbr-precode.png" alt="P6"  />
</p>
<p>å¯ä»¥çœ‹åˆ°åœ°å€ 0x01BE&ndash;0x01FD çš„ç¡®å­˜åœ¨åˆ†åŒºè¡¨ï¼Œä¸”æœ‰ MBR æœ‰æ•ˆæ ‡å¿— 0x55AAï¼Œä½†æ˜¯æˆ‘ä»¬æå–å‡ºæ¥ä¸º 0xAA55 ï¼Œè¿™é‡Œè‚¯å®šæ˜¯å¤§å°ç«¯ä¸ä¸€è‡´é€ æˆçš„ã€‚</p>
<p>æ ¹æ®ç¡¬ç›˜åˆ†åŒºè¡¨ç»“æ„ä¿¡æ¯åˆ†æå‡ºæ¥çš„åˆ†åŒºæƒ…å†µå’Œ fdisk å·¥å…·æŸ¥çœ‹çš„åˆ†åŒºæƒ…å†µä¸€è‡´ã€‚</p>
<p><img loading="lazy" src="Partition-struct.png" alt="P7"  />
</p>
<h3 id="å¯åŠ¨ä»£ç ">å¯åŠ¨ä»£ç <a hidden class="anchor" aria-hidden="true" href="#å¯åŠ¨ä»£ç ">#</a></h3>
<p>å‰é¢é•œåƒåˆ†æå‡ºï¼ŒMBR å ç”¨äº†ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼Œæ‰€ä»¥å¯åŠ¨ä»£ç  MLO å’Œ U-Boot è‚¯å®šå­˜å‚¨åœ¨åœ°å€ <code>0x20000</code>ã€<code>0x40000</code>æˆ–<code>0x60000</code>å¤„ã€‚
RAW æ¨¡å¼ä¸‹å­˜å‚¨ä¹Ÿæœ‰ä¸€å®šæ ¼å¼ï¼Œå¦‚æœæ˜¯é€šç”¨è®¾å¤‡ï¼Œåˆ™ <code>TOC structure/Configuration Header</code> åˆ™å¿…é¡»å­˜å‚¨åœ¨ç¬¬ä¸€ä¸ªæ‰‡åŒºä¸­ï¼Œå¹¶ä¸”ç´§è·Ÿç€æ˜¯ <code>GP Header</code>ã€‚</p>
<blockquote>
<p>The raw mode is detected by reading sectors #0, #256, #512, #768. The content of these sectors is then verified for presence of a TOC structure as described in Section 26.1.9. In the case of a GP Device, a Configuration Header (CH) must be located in the first sector followed by a GP header. The CH might be void (only containing a CHSETTINGS item for which the Valid field is zero).</p>
</blockquote>
<p><img loading="lazy" src="raw-mode-struct.png" alt="P8"  />
</p>
<p>è¿˜æ˜¯åˆ†æåˆšåˆšæå–å‡ºæ¥çš„æ•°æ®ï¼Œ ä»åœ°å€ <code>0x20000</code> å¼€å§‹çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼š</p>
<p><img loading="lazy" src="mlo-data.png" alt="P9"  />
</p>
<p>çœ‹æ•°æ®çš„ç¡®åŒ…å«äº† RAW Mode çš„é…ç½®å¤´ã€‚
é‚£ä¹ˆè¿™ä¸ªæ‰‡åŒºä¹‹åç´§è·Ÿç€å°±æ˜¯åŒ…å« <code>GP Header</code> çš„é•œåƒæ–‡ä»¶æ•°æ®äº†ï¼Œä»åœ°å€ <code>0x0000</code> å¼€å§‹ä¸ºæ•°æ®å¤§å°ï¼Œåœ°å€ <code>0x0004</code> å¼€å§‹ä¸ºè¦æ‹·è´è‡³çš„ç›®æ ‡åœ°å€ï¼Œ<code>0x0008</code> åœ°å€å¼€å§‹æ¥ä¸‹æ¥å°±æ˜¯é•œåƒæ•°æ®ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="image-format.png" alt="P10"  />
</p>
<p>è¿˜æ˜¯ç”¨ <code>hexdump</code> åˆ†æï¼š</p>
<p><img loading="lazy" src="image-data.png" alt="P11"  />
</p>
<p>å¤§å°ç«¯è½¬æ¢ä¸‹å¾—åˆ°ï¼šé•œåƒæ•°æ®å¤§å°ä¸º 0x0000fe4c ï¼ 65100 bytesï¼Œç›®æ ‡åœ°å€ä¸º 0x402f0400ï¼Œæ­¤åœ°å€ä¸º AM335x çš„å†…éƒ¨ SRAM çš„åœ°å€ï¼Œæ‰€ä»¥ RAM Code ä¼šæŠŠ MLO æ‹·è´åˆ°å†…éƒ¨ SRAM è¿è¡Œã€‚</p>
<p>MLO å¯åŠ¨ä¹‹åä¼šåœ¨åœ°å€ <code>0x60000</code> ä¹Ÿå°±æ˜¯<code>ç¬¬ 0x300 æ‰‡åŒº</code>å¼€å§‹åŠ è½½ U-Bootã€‚ï¼ˆMLO ä¼šåˆ†åˆ«åœ¨ RAW æ¨¡å¼ FAT ç­‰æ¨¡å¼ä¸‹æŸ¥æ‰¾å¯ç”¨çš„ u-boot.imgï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>hexdump</code> å·¥å…·ä¹Ÿçš„ç¡®èƒ½ä»åœ°å€ <code>0x60000</code> å¼€å§‹å‘ç°æœ‰æ•ˆæ•°æ®ã€‚</p>
<p>U-Boot å¯åŠ¨åä¼šæ ¹æ® U-Boot é…ç½®çš„æ–‡ä»¶ä½ç½®ä¿¡æ¯ï¼ˆ<code>DFU_ALT_INFO_MMC</code>ï¼‰æŸ¥æ‰¾å¯ç”¨çš„ <code>uEnv.txt</code> æ–‡ä»¶ï¼Œå¹¶è¿è¡Œç›¸å…³çš„å‘½ä»¤ï¼š</p>
<pre tabindex="0"><code>##These are needed to be compliant with Angstrom&#39;s 2013.06.20 u-boot.

loadaddr=0x82000000
fdtaddr=0x88000000
rdaddr=0x88080000

initrd_high=0xffffffff
fdt_high=0xffffffff

##These are needed to be compliant with Debian 2014-05-14 u-boot.

loadximage=echo debug: [/boot/vmlinuz-${uname_r}] ... ; load mmc 0:2 ${loadaddr} /boot/vmlinuz-${uname_r}
loadxfdt=echo debug: [/boot/dtbs/${uname_r}/${fdtfile}] ... ;load mmc 0:2 ${fdtaddr} /boot/dtbs/${uname_r}/${fdtfile}
loadxrd=echo debug: [/boot/initrd.img-${uname_r}] ... ; load mmc 0:2 ${rdaddr} /boot/initrd.img-${uname_r}; setenv rdsize ${filesize}
loaduEnvtxt=load mmc 0:2 ${loadaddr} /boot/uEnv.txt ; env import -t ${loadaddr} ${filesize};
check_dtb=if test -n ${dtb}; then setenv fdtfile ${dtb};fi;
loadall=run loaduEnvtxt; run check_dtb; run loadximage; run loadxrd; run loadxfdt;

mmcargs=setenv bootargs console=tty0 console=${console} ${optargs} ${cape_disable} ${cape_enable} root=/dev/mmcblk0p2 rootfstype=${mmcrootfstype} ${cmdline}

uenvcmd=run loadall; run mmcargs; echo debug: [${bootargs}] ... ; echo debug: [bootz ${loadaddr} ${rdaddr}:${rdsize} ${fdtaddr}] ... ; bootz ${loadaddr} ${rdaddr}:${rdsize} ${fdtaddr};
</code></pre><p>å®˜æ–¹é•œåƒé‡Œé¢çš„ <code>uEnv.txt</code> ä¸»è¦åŒ…å«ä»å“ªä¸ªä½ç½®åŠ è½½å†…æ ¸é•œåƒçš„å‘½ä»¤ï¼ŒU-Boot åŠ è½½æ–‡ä»¶ååä¼šè¿è¡Œ <code>uenvcmd</code> å‘½ä»¤ï¼Œè¿™æ ·å°±èƒ½å¯åŠ¨ Linux å†…æ ¸äº†ã€‚</p>
<h2 id="å¦‚ä½•çƒ§å†™">å¦‚ä½•çƒ§å†™<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•çƒ§å†™">#</a></h2>
<p>å°†Bootloaderæ˜ åƒç”¨ RAW æ¨¡å¼ä¿å­˜åˆ°eMMC/SDå¡ä¸­ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†æ–‡ä»¶å†™å…¥åˆ°SDå¡æˆ–è€…eMMCçš„èµ·å§‹ä½ç½®ï¼š</p>
<pre tabindex="0"><code># è¿™é‡Œçš„conv=ontruncåŠ ä¸åŠ éƒ½è¡Œï¼Œå› ä¸ºå¯¹äºå—è®¾å¤‡æ¥è¯´ï¼Œnotruncæ²¡æœ‰ä½œç”¨
# æ¯ä¸ªblockä¸º512å­—èŠ‚ï¼Œè·³è¿‡256ä¸ªblockï¼Œå†™å…¥256ä¸ªblock
dd if=MLO of=/dev/sdb bs=512 seek=256 count=256 conv=notrunc
dd if=u-boot.img of=/dev/sdb bs=512 seek=768 count=1024 conv=notrunc
</code></pre><p>å¦‚æœä½ å†™å…¥çš„æ˜¯ä¸€ä¸ªå¯æ’æ‹”SDå¡ï¼Œé‚£ä¹ˆç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç¡®ä¿å†…å®¹éƒ½ç¡®å®å†™å…¥åˆ°äº†å¡ä¸­ï¼š</p>
<pre tabindex="0"><code>sudo blockdev --flushbufs /dev/sdb
</code></pre><h2 id="å‚è€ƒ">å‚è€ƒ<a hidden class="anchor" aria-hidden="true" href="#å‚è€ƒ">#</a></h2>
<ul>
<li><a href="http://blog.chinaunix.net/uid-24774106-id-3340397.html">ä¸»å¼•å¯¼æ‰‡åŒºMBRçš„è§£æ </a>;</li>
<li><a href="https://uframer.gitbooks.io/beaglebone-black-notes/content/upgrading_u-boot.html">Beaglebone Black Notes</a>;</li>
<li><a href="http://blog.itpub.net/29475508/viewspace-1850126/">Linuxæ“ä½œç³»ç»Ÿ è¯»å–MBRä¿¡æ¯</a></li>
</ul>
<hr>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jesseguox.github.io/tinyx/tags/BeagleBone/">BeagleBone</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://jesseguox.github.io/tinyx/post/BBB-Prepare-booting/">
    <span class="title">Â« Prev Page</span>
    <br>
    <span>BeagleBone Black ä»é›¶åˆ°ä¸€ (3 Linux é•œåƒã€initramfsã€Device TreeåŠæ ¹æ–‡ä»¶ç³»ç»Ÿ)</span>
  </a>
  <a class="next" href="https://jesseguox.github.io/tinyx/post/BBB-Uboot/">
    <span class="title">Next Page Â»</span>
    <br>
    <span>BeagleBone Black ä»é›¶åˆ°ä¸€ (2 MLOã€U-Boot)</span>
  </a>
</nav>

  </footer><div id="utter-container"></div>
  <script src="https://utteranc.es/client.js"
      repo= 'JesseGuoX/hugoblogtalks'
      issue-term= "pathname"
      theme= ''
      crossorigin= "anonymous"
      async>
  </script>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://jesseguox.github.io/tinyx/">TinyX</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
